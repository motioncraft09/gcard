<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneXX - Admin Panel with Diagnostics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #06b6d4;
            --light-bg: #f9fafb;
            --card-bg: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--light-bg);
            color: var(--text-dark);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .card-white {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-light);
        }
        
        .nav-active {
            background-color: rgb(224 231 255);
            color: rgb(79 70 229);
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-active {
            background-color: #dcfce7;
            color: #16a34a;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }
        
        .status-expired {
            background-color: #fee2e2;
            color: #dc2626;
        }
        
        .diagnostic-panel {
            border-left: 4px solid var(--primary);
            background-color: #f8fafc;
        }
        
        .log-entry {
            border-bottom: 1px solid #e2e8f0;
            padding: 8px 12px;
            font-family: monospace;
            font-size: 13px;
        }
        
        .log-error {
            color: var(--danger);
        }
        
        .log-success {
            color: var(--success);
        }
        
        .log-warning {
            color: var(--warning);
        }
        
        .connection-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .connected {
            background-color: var(--success);
        }
        
        .disconnected {
            background-color: var(--danger);
        }
        
        .scanning {
            background-color: var(--warning);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex items-center text-indigo-600 font-bold text-xl cursor-pointer">
                        <span class="mr-2"><i class="fas fa-shield-alt"></i></span> OneXX Admin
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="connection-status" class="connection-status scanning"></span>
                    <span id="connection-text" class="text-sm text-gray-600">Scanning for data...</span>
                    <button id="nav-dashboard" class="px-3 py-2 rounded-md text-sm font-medium nav-active">
                        Dashboard
                    </button>
                    <button id="nav-diagnostics" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-gray-100">
                        Diagnostics
                    </button>
                    <button id="refresh-data" class="px-3 py-2 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">
                        <i class="fas fa-sync-alt mr-1"></i> Refresh
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-16">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="p-6">
            <div class="max-w-7xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Admin Dashboard</h1>
                
                <!-- Data Status Card -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Data Connection Status</h2>
                    </div>
                    <div class="px-6 py-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Connection Information</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Main Website URL:</span>
                                        <span id="main-site-url" class="font-medium">Unknown</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Data Source:</span>
                                        <span id="data-source" class="font-medium">Checking...</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Last Data Refresh:</span>
                                        <span id="last-refresh" class="font-medium">Never</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Storage Keys Found:</span>
                                        <span id="keys-found" class="font-medium">0</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Troubleshooting</h3>
                                <div class="space-y-3">
                                    <button id="scan-storage" class="w-full bg-indigo-600 text-white font-medium py-2 px-4 rounded-md hover:bg-indigo-700 transition-all duration-300">
                                        <i class="fas fa-search mr-2"></i> Scan Storage Keys
                                    </button>
                                    <button id="import-demo" class="w-full bg-green-600 text-white font-medium py-2 px-4 rounded-md hover:bg-green-700 transition-all duration-300">
                                        <i class="fas fa-download mr-2"></i> Import Demo Data
                                    </button>
                                    <button id="clear-storage" class="w-full bg-red-600 text-white font-medium py-2 px-4 rounded-md hover:bg-red-700 transition-all duration-300">
                                        <i class="fas fa-trash mr-2"></i> Clear All Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data Preview -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Guarantees Preview -->
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <div class="gradient-bg px-6 py-4">
                            <h2 class="text-xl font-bold text-white">Guarantees Preview</h2>
                        </div>
                        <div class="px-6 py-4">
                            <div class="flex justify-between mb-4">
                                <span class="text-gray-600">Total Guarantees:</span>
                                <span id="total-guarantees" class="font-medium">0</span>
                            </div>
                            <div id="guarantees-preview" class="text-gray-500 text-sm">
                                No guarantees data found
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Preview -->
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <div class="gradient-bg px-6 py-4">
                            <h2 class="text-xl font-bold text-white">Settings Preview</h2>
                        </div>
                        <div class="px-6 py-4">
                            <div id="fees-preview" class="mb-4">
                                <h3 class="text-gray-600 text-sm">Fee Structure:</h3>
                                <div class="text-gray-500 text-sm">Not configured</div>
                            </div>
                            <div id="payments-preview">
                                <h3 class="text-gray-600 text-sm">Payment Methods:</h3>
                                <div class="text-gray-500 text-sm">Not configured</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Diagnostics Section -->
        <section id="diagnostics-section" class="p-6 hidden">
            <div class="max-w-7xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Diagnostics</h1>
                
                <!-- Storage Scanner -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Storage Scanner</h2>
                    </div>
                    <div class="px-6 py-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Storage Key Patterns to Scan For:
                            </label>
                            <div class="flex flex-wrap gap-2">
                                <span class="bg-gray-200 text-gray-800 text-xs font-medium px-2 py-1 rounded">onexx</span>
                                <span class="bg-gray-200 text-gray-800 text-xs font-medium px-2 py-1 rounded">guarantee</span>
                                <span class="bg-gray-200 text-gray-800 text-xs font-medium px-2 py-1 rounded">payment</span>
                                <span class="bg-gray-200 text-gray-800 text-xs font-medium px-2 py-1 rounded">fee</span>
                                <span class="bg-gray-200 text-gray-800 text-xs font-medium px-2 py-1 rounded">certificate</span>
                            </div>
                        </div>
                        <button id="start-scan" class="bg-indigo-600 text-white font-medium py-2 px-4 rounded-md hover:bg-indigo-700 transition-all duration-300">
                            <i class="fas fa-search mr-2"></i> Scan LocalStorage
                        </button>
                    </div>
                </div>
                
                <!-- Scan Results -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Scan Results</h2>
                    </div>
                    <div class="px-6 py-6">
                        <div id="scan-results" class="text-gray-500">
                            No scan performed yet. Click "Scan LocalStorage" to check for data.
                        </div>
                    </div>
                </div>
                
                <!-- Diagnostic Log -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Diagnostic Log</h2>
                    </div>
                    <div class="px-6 py-6">
                        <div class="diagnostic-panel">
                            <div id="log-entries">
                                <div class="log-entry">
                                    <span class="text-gray-400">[</span><span class="text-blue-500">INFO</span><span class="text-gray-400">]</span> Admin panel initialized
                                </div>
                                <div class="log-entry">
                                    <span class="text-gray-400">[</span><span class="text-blue-500">INFO</span><span class="text-gray-400">]</span> Scanning for data...
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button id="clear-log" class="bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-md hover:bg-gray-300 transition-all duration-300">
                                Clear Log
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Data storage keys - try multiple possibilities
        const POSSIBLE_STORAGE_KEYS = {
            GUARANTEES: [
                'onexx_guarantees',
                'onexx_guarantee_data',
                'guarantees',
                'onexx_data',
                'onexx_certificates'
            ],
            FEES: [
                'onexx_fee_structure',
                'onexx_fees',
                'fee_structure',
                'onexx_pricing'
            ],
            PAYMENTS: [
                'onexx_payment_methods',
                'onexx_payments',
                'payment_methods'
            ],
            CERTIFICATE: [
                'onexx_sample_certificate',
                'sample_certificate',
                'onexx_demo_certificate'
            ]
        };

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set up navigation
            const navDashboard = document.getElementById('nav-dashboard');
            const navDiagnostics = document.getElementById('nav-diagnostics');
            const dashboardSection = document.getElementById('dashboard-section');
            const diagnosticsSection = document.getElementById('diagnostics-section');
            
            navDashboard.addEventListener('click', function() {
                dashboardSection.classList.remove('hidden');
                diagnosticsSection.classList.add('hidden');
                navDashboard.classList.add('nav-active');
                navDiagnostics.classList.remove('nav-active');
            });
            
            navDiagnostics.addEventListener('click', function() {
                dashboardSection.classList.add('hidden');
                diagnosticsSection.classList.remove('hidden');
                navDashboard.classList.remove('nav-active');
                navDiagnostics.classList.add('nav-active');
            });
            
            // Set up button handlers
            document.getElementById('refresh-data').addEventListener('click', scanForData);
            document.getElementById('scan-storage').addEventListener('click', scanForData);
            document.getElementById('start-scan').addEventListener('click', scanLocalStorage);
            document.getElementById('import-demo').addEventListener('click', importDemoData);
            document.getElementById('clear-storage').addEventListener('click', clearStorage);
            document.getElementById('clear-log').addEventListener('click', clearLog);
            
            // Initial scan for data
            scanForData();
            
            // Try to detect the main website URL
            try {
                // If we're on GitHub Pages, try to guess the main site URL
                const currentUrl = window.location.href;
                if (currentUrl.includes('/admin.html') || currentUrl.includes('/admin/')) {
                    const mainSiteUrl = currentUrl.replace('/admin.html', '/index.html').replace('/admin/', '/');
                    document.getElementById('main-site-url').textContent = mainSiteUrl;
                } else {
                    document.getElementById('main-site-url').textContent = window.location.origin + '/index.html';
                }
            } catch (e) {
                document.getElementById('main-site-url').textContent = 'Unknown';
            }
        });
        
        // Add a log entry
        function addLogEntry(message, type = 'info') {
            const logEntries = document.getElementById('log-entries');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            let typeClass = 'text-blue-500';
            if (type === 'error') typeClass = 'text-red-500';
            if (type === 'success') typeClass = 'text-green-500';
            if (type === 'warning') typeClass = 'text-yellow-500';
            
            entry.innerHTML = `
                <span class="text-gray-400">[</span><span class="${typeClass}">${type.toUpperCase()}</span><span class="text-gray-400">]</span> ${message}
            `;
            
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
        }
        
        // Clear the log
        function clearLog() {
            document.getElementById('log-entries').innerHTML = `
                <div class="log-entry">
                    <span class="text-gray-400">[</span><span class="text-blue-500">INFO</span><span class="text-gray-400">]</span> Log cleared
                </div>
            `;
        }
        
        // Scan for data from the main website
        function scanForData() {
            const connectionStatus = document.getElementById('connection-status');
            const connectionText = document.getElementById('connection-text');
            
            connectionStatus.className = 'connection-status scanning';
            connectionText.textContent = 'Scanning for data...';
            
            addLogEntry('Scanning for data from main website...');
            
            // Check for all possible storage keys
            let foundKeys = 0;
            let foundData = false;
            
            // Check for guarantees data
            for (const key of POSSIBLE_STORAGE_KEYS.GUARANTEES) {
                const data = localStorage.getItem(key);
                if (data) {
                    foundKeys++;
                    foundData = true;
                    addLogEntry(`Found guarantees data with key: ${key}`, 'success');
                    
                    try {
                        const guarantees = JSON.parse(data);
                        document.getElementById('total-guarantees').textContent = guarantees.length;
                        
                        // Update preview
                        let previewHtml = '';
                        if (guarantees.length > 0) {
                            const recent = guarantees.slice(-3); // Show last 3
                            previewHtml = recent.map(g => `
                                <div class="mb-2 p-2 bg-gray-100 rounded">
                                    <div class="font-medium">${g.certificateId || 'Unknown ID'}</div>
                                    <div class="text-xs">${g.seller || 'Unknown'} → ${g.buyer || 'Unknown'}</div>
                                </div>
                            `).join('');
                        } else {
                            previewHtml = '<div class="text-gray-500">No guarantees found</div>';
                        }
                        document.getElementById('guarantees-preview').innerHTML = previewHtml;
                    } catch (e) {
                        addLogEntry(`Error parsing guarantees data: ${e.message}`, 'error');
                    }
                    
                    break;
                }
            }
            
            // Check for fee structure
            for (const key of POSSIBLE_STORAGE_KEYS.FEES) {
                const data = localStorage.getItem(key);
                if (data) {
                    foundKeys++;
                    foundData = true;
                    addLogEntry(`Found fee data with key: ${key}`, 'success');
                    
                    try {
                        const fees = JSON.parse(data);
                        document.getElementById('fees-preview').innerHTML = `
                            <h3 class="text-gray-600 text-sm">Fee Structure:</h3>
                            <div class="text-sm">
                                Tier 1: ${fees.tier1 || 'N/A'}%<br>
                                Tier 2: ${fees.tier2 || 'N/A'}%<br>
                                Tier 3: ${fees.tier3 || 'N/A'}%<br>
                                Minimum: $${fees.minTier3 || 'N/A'}
                            </div>
                        `;
                    } catch (e) {
                        addLogEntry(`Error parsing fee data: ${e.message}`, 'error');
                    }
                    
                    break;
                }
            }
            
            // Check for payment methods
            for (const key of POSSIBLE_STORAGE_KEYS.PAYMENTS) {
                const data = localStorage.getItem(key);
                if (data) {
                    foundKeys++;
                    foundData = true;
                    addLogEntry(`Found payment data with key: ${key}`, 'success');
                    
                    try {
                        const payments = JSON.parse(data);
                        document.getElementById('payments-preview').innerHTML = `
                            <h3 class="text-gray-600 text-sm">Payment Methods:</h3>
                            <div class="text-sm">
                                bKash: ${payments.bkash || 'N/A'}<br>
                                Nagad: ${payments.nagad || 'N/A'}<br>
                                Rocket: ${payments.rocket || 'N/A'}<br>
                                PayPal: ${payments.paypal || 'N/A'}
                            </div>
                        `;
                    } catch (e) {
                        addLogEntry(`Error parsing payment data: ${e.message}`, 'error');
                    }
                    
                    break;
                }
            }
            
            // Update status
            document.getElementById('keys-found').textContent = foundKeys;
            document.getElementById('last-refresh').textContent = new Date().toLocaleTimeString();
            
            if (foundData) {
                connectionStatus.className = 'connection-status connected';
                connectionText.textContent = `Connected (${foundKeys} data sources found)`;
                document.getElementById('data-source').textContent = 'LocalStorage';
                addLogEntry(`Found ${foundKeys} data sources`, 'success');
            } else {
                connectionStatus.className = 'connection-status disconnected';
                connectionText.textContent = 'No data found';
                document.getElementById('data-source').textContent = 'None';
                addLogEntry('No data found from main website', 'warning');
            }
        }
        
        // Scan all localStorage for potential data keys
        function scanLocalStorage() {
            addLogEntry('Scanning all localStorage keys...');
            
            let resultsHtml = '';
            let foundCount = 0;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                
                // Check if this might be our data
                if (key.includes('onexx') || key.includes('guarantee') || key.includes('payment') || 
                    key.includes('fee') || key.includes('certificate')) {
                    foundCount++;
                    
                    try {
                        const parsedValue = JSON.parse(value);
                        resultsHtml += `
                            <div class="mb-4 p-3 bg-gray-100 rounded">
                                <div class="font-medium mb-1">${key}</div>
                                <div class="text-xs text-gray-600 overflow-x-auto">
                                    ${JSON.stringify(parsedValue, null, 2)}
                                </div>
                            </div>
                        `;
                    } catch (e) {
                        resultsHtml += `
                            <div class="mb-4 p-3 bg-gray-100 rounded">
                                <div class="font-medium mb-1">${key}</div>
                                <div class="text-xs text-gray-600">${value}</div>
                            </div>
                        `;
                    }
                }
            }
            
            if (foundCount > 0) {
                document.getElementById('scan-results').innerHTML = resultsHtml;
                addLogEntry(`Found ${foundCount} potentially relevant keys in localStorage`, 'success');
            } else {
                document.getElementById('scan-results').innerHTML = 'No relevant keys found in localStorage';
                addLogEntry('No relevant keys found in localStorage', 'warning');
            }
        }
        
        // Import demo data for testing
        function importDemoData() {
            addLogEntry('Importing demo data...');
            
            // Demo guarantees
            const demoGuarantees = [
                {
                    id: 1,
                    certificateId: 'OXX-987654-XYZ',
                    seller: 'John\'s Service',
                    buyer: 'Jane Client',
                    value: '$1,200.00',
                    status: 'active',
                    created: '2023-10-15'
                },
                {
                    id: 2,
                    certificateId: 'OXX-987653-XYZ',
                    seller: 'Mike\'s Repairs',
                    buyer: 'Sarah Johnson',
                    value: '$850.00',
                    status: 'pending',
                    created: '2023-10-14'
                }
            ];
            
            // Demo fee structure
            const demoFees = {
                tier1: 5,
                tier2: 3,
                tier3: 2,
                minTier3: 8
            };
            
            // Demo payment methods
            const demoPayments = {
                bkash: '01322149482',
                nagad: '01322149482',
                rocket: '01322149482',
                paypal: 'payments@onexx.com'
            };
            
            // Save to localStorage
            localStorage.setItem('onexx_guarantees', JSON.stringify(demoGuarantees));
            localStorage.setItem('onexx_fee_structure', JSON.stringify(demoFees));
            localStorage.setItem('onexx_payment_methods', JSON.stringify(demoPayments));
            
            addLogEntry('Demo data imported successfully', 'success');
            
            // Refresh the view
            scanForData();
        }
        
        // Clear all storage
        function clearStorage() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                // Clear all possible keys
                Object.values(POSSIBLE_STORAGE_KEYS).flat().forEach(key => {
                    localStorage.removeItem(key);
                });
                
                addLogEntry('All data cleared from localStorage', 'success');
                
                // Refresh the view
                scanForData();
            }
        }
    </script>
</body>
</html>
