<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneXX Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #06b6d4;
            --accent: #f59e0b;
            --light-bg: #f9fafb;
            --card-bg: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-light: #e5e7eb;
            --error: #ef4444;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--light-bg);
            color: var(--text-dark);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .card-white {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-light);
        }
        
        .input-field {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: var(--text-dark);
            transition: all 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .admin-table th, .admin-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .admin-table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .admin-table tr:hover {
            background-color: #f3f4f6;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-active {
            background-color: #10b981;
            color: white;
        }
        
        .status-pending {
            background-color: #f59e0b;
            color: white;
        }
        
        .status-expired {
            background-color: #ef4444;
            color: white;
        }
        
        .edit-btn {
            color: #4f46e5;
            cursor: pointer;
        }
        
        .edit-btn:hover {
            color: #3730a3;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-button.active {
            background-color: rgb(224 231 255);
            color: rgb(79 70 229);
        }
        
        .import-export-box {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .import-export-box:hover {
            border-color: #4f46e5;
            background-color: #f5f7ff;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex items-center text-indigo-600 font-bold text-xl">
                        <span class="mr-2"><i class="fas fa-shield-alt"></i></span> OneXX Admin Panel
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="nav-dashboard" class="tab-button active">
                        Dashboard
                    </button>
                    <button id="nav-settings" class="tab-button">
                        Settings
                    </button>
                    <button id="nav-tools" class="tab-button">
                        Tools
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="active-section">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Guarantee Certificates</h2>
                <p class="text-gray-600">View and manage all guarantee certificates</p>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="gradient-bg px-6 py-4">
                    <h2 class="text-xl font-bold text-white">All Certificates</h2>
                </div>
                <div class="px-6 py-4">
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Certificate ID</th>
                                    <th>Seller</th>
                                    <th>Buyer</th>
                                    <th>Service</th>
                                    <th>Budget</th>
                                    <th>Fee</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="certificates-table-body">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="no-data-message" class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No guarantee certificates found</p>
                        <p class="text-sm mt-2">Data will appear here once you've added guarantees on the main website</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-indigo-100 text-indigo-600">
                            <i class="fas fa-file-contract text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-600">Total Certificates</h3>
                            <p class="text-2xl font-bold text-gray-900" id="total-certificates">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600">
                            <i class="fas fa-check-circle text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-600">Active Certificates</h3>
                            <p class="text-2xl font-bold text-gray-900" id="active-certificates">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                            <i class="fas fa-dollar-sign text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-600">Total Value</h3>
                            <p class="text-2xl font-bold text-gray-900" id="total-value">$0.00</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Settings Section -->
        <section id="settings-section" class="hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Admin Settings</h2>
                <p class="text-gray-600">Manage sample certificate and payment methods</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Sample Certificate Settings -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Sample Certificate</h2>
                    </div>
                    <div class="px-6 py-4">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Seller Name
                            </label>
                            <input type="text" id="sample-seller-name" class="w-full px-4 py-2 input-field rounded-md" placeholder="John's Repair Service">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Buyer Name
                            </label>
                            <input type="text" id="sample-buyer-name" class="w-full px-4 py-2 input-field rounded-md" placeholder="Jane Client">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Service Value
                            </label>
                            <input type="text" id="sample-service-value" class="w-full px-4 py-2 input-field rounded-md" placeholder="$1,500">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Status
                            </label>
                            <select id="sample-status" class="w-full px-4 py-2 input-field rounded-md">
                                <option value="Active">Active</option>
                                <option value="Pending">Pending</option>
                                <option value="Expired">Expired</option>
                            </select>
                        </div>
                        
                        <div class="mt-6 flex justify-end">
                            <button id="save-sample-certificate" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Methods Settings -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Payment Methods</h2>
                    </div>
                    <div class="px-6 py-4">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                bKash Number
                            </label>
                            <input type="text" id="bkash-number" class="w-full px-4 py-2 input-field rounded-md" placeholder="01322149482">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Nagad Number
                            </label>
                            <input type="text" id="nagad-number" class="w-full px-4 py-2 input-field rounded-md" placeholder="01322149482">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Rocket Number
                            </label>
                            <input type="text" id="rocket-number" class="w-full px-4 py-2 input-field rounded-md" placeholder="01322149482">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                PayPal Email
                            </label>
                            <input type="email" id="paypal-email" class="w-full px-4 py-2 input-field rounded-md" placeholder="payments@onexx.com">
                        </div>
                        
                        <div class="mt-6 flex justify-end">
                            <button id="save-payment-methods" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Fee Structure Settings -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Fee Structure</h2>
                    </div>
                    <div class="px-6 py-4">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Small Budget Threshold ($)
                            </label>
                            <input type="number" id="small-budget-threshold" class="w-full px-4 py-2 input-field rounded-md" placeholder="40.00" step="0.01" min="0">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Medium Budget Threshold ($)
                            </label>
                            <input type="number" id="medium-budget-threshold" class="w-full px-4 py-2 input-field rounded-md" placeholder="160.00" step="0.01" min="0">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Small Budget Fee (%)
                            </label>
                            <input type="number" id="small-budget-fee" class="w-full px-4 py-2 input-field rounded-md" placeholder="5" step="0.1" min="0">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Medium Budget Fee (%)
                            </label>
                            <input type="number" id="medium-budget-fee" class="w-full px-4 py-2 input-field rounded-md" placeholder="3" step="0.1" min="0">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Large Budget Fee (%)
                            </label>
                            <input type="number" id="large-budget-fee" class="w-full px-4 py-2 input-field rounded-md" placeholder="2" step="0.1" min="0">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Minimum Fee ($)
                            </label>
                            <input type="number" id="minimum-fee" class="w-full px-4 py-2 input-field rounded-md" placeholder="8.00" step="0.01" min="0">
                        </div>
                        
                        <div class="mt-6 flex justify-end">
                            <button id="save-fee-structure" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Tools Section -->
        <section id="tools-section" class="hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Admin Tools</h2>
                <p class="text-gray-600">Import, export, and manage application data</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Data Export -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Export Data</h2>
                    </div>
                    <div class="px-6 py-4">
                        <p class="text-gray-600 mb-4">Export all guarantee data as a JSON file for backup or analysis.</p>
                        
                        <div class="import-export-box" id="export-data">
                            <div class="text-4xl mb-2">
                                <i class="fas fa-file-export text-indigo-600"></i>
                            </div>
                            <h3 class="font-medium text-gray-900">Export Data</h3>
                            <p class="text-sm text-gray-600 mt-1">Click to download all data as JSON</p>
                        </div>
                    </div>
                </div>
                
                <!-- Data Import -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Import Data</h2>
                    </div>
                    <div class="px-6 py-4">
                        <p class="text-gray-600 mb-4">Import guarantee data from a JSON file. This will replace all current data.</p>
                        
                        <div class="import-export-box" id="import-data">
                            <div class="text-4xl mb-2">
                                <i class="fas fa-file-import text-indigo-600"></i>
                            </div>
                            <h3 class="font-medium text-gray-900">Import Data</h3>
                            <p class="text-sm text-gray-600 mt-1">Click to upload and import JSON data</p>
                            <input type="file" id="import-file" class="hidden" accept=".json">
                        </div>
                        
                        <div class="mt-4 bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-yellow-800">Warning</h3>
                                    <div class="mt-2 text-sm text-yellow-700">
                                        <p>Importing data will replace all existing guarantees. Make sure to export your current data first if you want to keep it.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data Management -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-xl font-bold text-white">Data Management</h2>
                    </div>
                    <div class="px-6 py-4">
                        <p class="text-gray-600 mb-4">Manage your application data and storage.</p>
                        
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h3 class="font-medium text-gray-900 mb-2">Storage Information</h3>
                            <p class="text-sm text-gray-600" id="storage-info">Calculating...</p>
                        </div>
                        
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                            <h3 class="font-medium text-red-800 mb-2">Danger Zone</h3>
                            <p class="text-sm text-red-700 mb-4">These actions are irreversible. Please be cautious.</p>
                            
                            <button id="clear-all-data" class="bg-red-600 text-white font-medium py-2 px-4 rounded-md hover:bg-red-700 transition-all duration-300 text-sm">
                                Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Edit Certificate Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Edit Certificate</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Seller Name
                    </label>
                    <input type="text" id="edit-seller-name" class="w-full px-4 py-2 input-field rounded-md">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Buyer Name
                    </label>
                    <input type="text" id="edit-buyer-name" class="w-full px-4 py-2 input-field rounded-md">
                </div>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Service Description
                </label>
                <textarea id="edit-service-description" rows="3" class="w-full px-4 py-2 input-field rounded-md"></textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Service Budget ($)
                    </label>
                    <input type="number" id="edit-service-budget" class="w-full px-4 py-2 input-field rounded-md" step="0.01" min="0">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Guarantee Fee ($)
                    </label>
                    <input type="number" id="edit-guarantee-fee" class="w-full px-4 py-2 input-field rounded-md" step="0.01" min="0">
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Guarantee Period (days)
                    </label>
                    <input type="number" id="edit-guarantee-period" class="w-full px-4 py-2 input-field rounded-md" min="1">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Status
                    </label>
                    <select id="edit-status" class="w-full px-4 py-2 input-field rounded-md">
                        <option value="Pending Verification">Pending Verification</option>
                        <option value="Active">Active</option>
                        <option value="Expired">Expired</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button id="cancel-edit" class="bg-gray-300 text-gray-700 font-medium py-2 px-6 rounded-md hover:bg-gray-400 transition-all duration-300">
                    Cancel
                </button>
                <button id="save-certificate-changes" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data storage keys - must match the main website
        const STORAGE_KEY = 'onexx_guarantees';
        const SAMPLE_CERTIFICATE_KEY = 'onexx_sample_certificate';
        const PAYMENT_METHODS_KEY = 'onexx_payment_methods';
        const FEE_STRUCTURE_KEY = 'onexx_fee_structure';
        
        // Current certificate being edited
        let currentEditCertificateId = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Set up navigation
            setupNavigation();
            
            // Load dashboard data
            loadDashboardData();
            
            // Load settings data
            loadSettingsData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Update storage info
            updateStorageInfo();
        });
        
        function setupNavigation() {
            const navDashboard = document.getElementById('nav-dashboard');
            const navSettings = document.getElementById('nav-settings');
            const navTools = document.getElementById('nav-tools');
            const dashboardSection = document.getElementById('dashboard-section');
            const settingsSection = document.getElementById('settings-section');
            const toolsSection = document.getElementById('tools-section');
            
            // Function to change active tab
            function changeActiveTab(activeTab) {
                // Hide all sections
                dashboardSection.classList.add('hidden');
                settingsSection.classList.add('hidden');
                toolsSection.classList.add('hidden');
                
                // Remove active class from all tabs
                navDashboard.classList.remove('active');
                navSettings.classList.remove('active');
                navTools.classList.remove('active');
                
                // Show the selected section and activate the tab
                if (activeTab === 'dashboard') {
                    dashboardSection.classList.remove('hidden');
                    navDashboard.classList.add('active');
                    loadDashboardData();
                } else if (activeTab === 'settings') {
                    settingsSection.classList.remove('hidden');
                    navSettings.classList.add('active');
                    loadSettingsData();
                } else if (activeTab === 'tools') {
                    toolsSection.classList.remove('hidden');
                    navTools.classList.add('active');
                    updateStorageInfo();
                }
            }
            
            // Add event listeners to navigation buttons
            navDashboard.addEventListener('click', function() {
                changeActiveTab('dashboard');
            });
            
            navSettings.addEventListener('click', function() {
                changeActiveTab('settings');
            });
            
            navTools.addEventListener('click', function() {
                changeActiveTab('tools');
            });
        }
        
        function loadDashboardData() {
            const guarantees = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            const tableBody = document.getElementById('certificates-table-body');
            const noDataMessage = document.getElementById('no-data-message');
            const totalCertificates = document.getElementById('total-certificates');
            const activeCertificates = document.getElementById('active-certificates');
            const totalValue = document.getElementById('total-value');
            
            // Update statistics
            totalCertificates.textContent = guarantees.length;
            
            const activeCount = guarantees.filter(g => g.status === 'Active').length;
            activeCertificates.textContent = activeCount;
            
            const totalBudget = guarantees.reduce((sum, g) => sum + g.serviceBudget, 0);
            totalValue.textContent = '$' + totalBudget.toFixed(2);
            
            if (guarantees.length === 0) {
                tableBody.innerHTML = '';
                noDataMessage.style.display = 'block';
                return;
            }
            
            noDataMessage.style.display = 'none';
            
            // Sort guarantees by date (newest first)
            guarantees.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            tableBody.innerHTML = guarantees.map(guarantee => `
                <tr>
                    <td class="font-mono">${guarantee.certificateId}</td>
                    <td>${guarantee.sellerName}<br><span class="text-xs text-gray-500">${guarantee.sellerEmail}</span></td>
                    <td>${guarantee.buyerName}<br><span class="text-xs text-gray-500">${guarantee.buyerEmail}</span></td>
                    <td>${guarantee.serviceDescription}</td>
                    <td>$ ${guarantee.serviceBudget.toFixed(2)}</td>
                    <td>$ ${guarantee.guaranteeFee.toFixed(2)}</td>
                    <td>
                        <span class="status-badge ${getStatusClass(guarantee.status)}">
                            ${guarantee.status}
                        </span>
                    </td>
                    <td>${new Date(guarantee.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button class="edit-btn" data-id="${guarantee.certificateId}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const certificateId = this.getAttribute('data-id');
                    openEditModal(certificateId);
                });
            });
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'Active':
                    return 'status-active';
                case 'Pending Verification':
                    return 'status-pending';
                case 'Expired':
                    return 'status-expired';
                default:
                    return 'status-pending';
            }
        }
        
        function openEditModal(certificateId) {
            const guarantees = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            const guarantee = guarantees.find(g => g.certificateId === certificateId);
            
            if (!guarantee) return;
            
            currentEditCertificateId = certificateId;
            
            // Fill the form with guarantee data
            document.getElementById('edit-seller-name').value = guarantee.sellerName;
            document.getElementById('edit-buyer-name').value = guarantee.buyerName;
            document.getElementById('edit-service-description').value = guarantee.serviceDescription;
            document.getElementById('edit-service-budget').value = guarantee.serviceBudget;
            document.getElementById('edit-guarantee-fee').value = guarantee.guaranteeFee;
            document.getElementById('edit-guarantee-period').value = guarantee.guaranteePeriod;
            document.getElementById('edit-status').value = guarantee.status;
            
            // Show the modal
            document.getElementById('edit-modal').style.display = 'flex';
        }
        
        function loadSettingsData() {
            // Load sample certificate data
            const sampleCertificate = JSON.parse(localStorage.getItem(SAMPLE_CERTIFICATE_KEY)) || {
                sellerName: "John's Service",
                buyerName: "Jane Client",
                serviceValue: "$1,500",
                status: "Active"
            };
            
            document.getElementById('sample-seller-name').value = sampleCertificate.sellerName;
            document.getElementById('sample-buyer-name').value = sampleCertificate.buyerName;
            document.getElementById('sample-service-value').value = sampleCertificate.serviceValue;
            document.getElementById('sample-status').value = sampleCertificate.status;
            
            // Load payment methods data
            const paymentMethods = JSON.parse(localStorage.getItem(PAYMENT_METHODS_KEY)) || {
                bkash: "01322149482",
                nagad: "01322149482",
                rocket: "01322149482",
                paypal: "payments@onexx.com"
            };
            
            document.getElementById('bkash-number').value = paymentMethods.bkash;
            document.getElementById('nagad-number').value = paymentMethods.nagad;
            document.getElementById('rocket-number').value = paymentMethods.rocket;
            document.getElementById('paypal-email').value = paymentMethods.paypal;
            
            // Load fee structure data
            const feeStructure = JSON.parse(localStorage.getItem(FEE_STRUCTURE_KEY)) || {
                smallBudgetThreshold: 40,
                mediumBudgetThreshold: 160,
                smallBudgetFee: 5,
                mediumBudgetFee: 3,
                largeBudgetFee: 2,
                minimumFee: 8
            };
            
            document.getElementById('small-budget-threshold').value = feeStructure.smallBudgetThreshold;
            document.getElementById('medium-budget-threshold').value = feeStructure.mediumBudgetThreshold;
            document.getElementById('small-budget-fee').value = feeStructure.smallBudgetFee;
            document.getElementById('medium-budget-fee').value = feeStructure.mediumBudgetFee;
            document.getElementById('large-budget-fee').value = feeStructure.largeBudgetFee;
            document.getElementById('minimum-fee').value = feeStructure.minimumFee;
        }
        
        function setupEventListeners() {
            // Save sample certificate
            document.getElementById('save-sample-certificate').addEventListener('click', function() {
                const sampleCertificate = {
                    sellerName: document.getElementById('sample-seller-name').value,
                    buyerName: document.getElementById('sample-buyer-name').value,
                    serviceValue: document.getElementById('sample-service-value').value,
                    status: document.getElementById('sample-status').value
                };
                
                localStorage.setItem(SAMPLE_CERTIFICATE_KEY, JSON.stringify(sampleCertificate));
                alert('Sample certificate settings saved successfully!');
            });
            
            // Save payment methods
            document.getElementById('save-payment-methods').addEventListener('click', function() {
                const paymentMethods = {
                    bkash: document.getElementById('bkash-number').value,
                    nagad: document.getElementById('nagad-number').value,
                    rocket: document.getElementById('rocket-number').value,
                    paypal: document.getElementById('paypal-email').value
                };
                
                localStorage.setItem(PAYMENT_METHODS_KEY, JSON.stringify(paymentMethods));
                alert('Payment methods saved successfully!');
            });
            
            // Save fee structure
            document.getElementById('save-fee-structure').addEventListener('click', function() {
                const feeStructure = {
                    smallBudgetThreshold: parseFloat(document.getElementById('small-budget-threshold').value),
                    mediumBudgetThreshold: parseFloat(document.getElementById('medium-budget-threshold').value),
                    smallBudgetFee: parseFloat(document.getElementById('small-budget-fee').value),
                    mediumBudgetFee: parseFloat(document.getElementById('medium-budget-fee').value),
                    largeBudgetFee: parseFloat(document.getElementById('large-budget-fee').value),
                    minimumFee: parseFloat(document.getElementById('minimum-fee').value)
                };
                
                localStorage.setItem(FEE_STRUCTURE_KEY, JSON.stringify(feeStructure));
                alert('Fee structure saved successfully!');
            });
            
            // Cancel edit
            document.getElementById('cancel-edit').addEventListener('click', function() {
                document.getElementById('edit-modal').style.display = 'none';
            });
            
            // Save certificate changes
            document.getElementById('save-certificate-changes').addEventListener('click', function() {
                if (!currentEditCertificateId) return;
                
                const guarantees = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
                const guaranteeIndex = guarantees.findIndex(g => g.certificateId === currentEditCertificateId);
                
                if (guaranteeIndex === -1) return;
                
                // Update the guarantee data
                guarantees[guaranteeIndex].sellerName = document.getElementById('edit-seller-name').value;
                guarantees[guaranteeIndex].buyerName = document.getElementById('edit-buyer-name').value;
                guarantees[guaranteeIndex].serviceDescription = document.getElementById('edit-service-description').value;
                guarantees[guaranteeIndex].serviceBudget = parseFloat(document.getElementById('edit-service-budget').value);
                guarantees[guaranteeIndex].guaranteeFee = parseFloat(document.getElementById('edit-guarantee-fee').value);
                guarantees[guaranteeIndex].guaranteePeriod = parseInt(document.getElementById('edit-guarantee-period').value);
                guarantees[guaranteeIndex].status = document.getElementById('edit-status').value;
                
                // Save back to localStorage
                localStorage.setItem(STORAGE_KEY, JSON.stringify(guarantees));
                
                // Close the modal and refresh the data
                document.getElementById('edit-modal').style.display = 'none';
                loadDashboardData();
                
                alert('Certificate updated successfully!');
            });
            
            // Close modal when clicking outside
            document.getElementById('edit-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            // Export data
            document.getElementById('export-data').addEventListener('click', function() {
                const guarantees = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
                const sampleCertificate = JSON.parse(localStorage.getItem(SAMPLE_CERTIFICATE_KEY)) || {};
                const paymentMethods = JSON.parse(localStorage.getItem(PAYMENT_METHODS_KEY)) || {};
                const feeStructure = JSON.parse(localStorage.getItem(FEE_STRUCTURE_KEY)) || {};
                
                const exportData = {
                    guarantees: guarantees,
                    sampleCertificate: sampleCertificate,
                    paymentMethods: paymentMethods,
                    feeStructure: feeStructure,
                    exportedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `onexx-data-${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            });
            
            // Import data
            document.getElementById('import-data').addEventListener('click', function() {
                document.getElementById('import-file').click();
            });
            
            document.getElementById('import-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importData = JSON.parse(e.target.result);
                        
                        if (importData.guarantees) {
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(importData.guarantees));
                        }
                        
                        if (importData.sampleCertificate) {
                            localStorage.setItem(SAMPLE_CERTIFICATE_KEY, JSON.stringify(importData.sampleCertificate));
                        }
                        
                        if (importData.paymentMethods) {
                            localStorage.setItem(PAYMENT_METHODS_KEY, JSON.stringify(importData.paymentMethods));
                        }
                        
                        if (importData.feeStructure) {
                            localStorage.setItem(FEE_STRUCTURE_KEY, JSON.stringify(importData.feeStructure));
                        }
                        
                        alert('Data imported successfully!');
                        loadDashboardData();
                        loadSettingsData();
                        updateStorageInfo();
                        
                    } catch (error) {
                        alert('Error importing data: Invalid file format');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
            });
            
            // Clear all data
            document.getElementById('clear-all-data').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                    localStorage.removeItem(STORAGE_KEY);
                    localStorage.removeItem(SAMPLE_CERTIFICATE_KEY);
                    localStorage.removeItem(PAYMENT_METHODS_KEY);
                    localStorage.removeItem(FEE_STRUCTURE_KEY);
                    
                    alert('All data has been cleared!');
                    loadDashboardData();
                    loadSettingsData();
                    updateStorageInfo();
                }
            });
        }
        
        function updateStorageInfo() {
            let totalSize = 0;
            
            // Calculate total storage size
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage[key].length * 2; // Approximate size in bytes (2 bytes per character)
                }
            }
            
            // Convert to KB
            const totalSizeKB = (totalSize / 1024).toFixed(2);
            
            // Count items
            const itemCount = localStorage.length;
            
            document.getElementById('storage-info').textContent = 
                `${itemCount} items, ${totalSizeKB} KB used`;
        }
    </script>
</body>
</html>
