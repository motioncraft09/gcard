<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneXX - Complete Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #06b6d4;
            --light-bg: #f9fafb;
            --card-bg: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--light-bg);
            color: var(--text-dark);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .card-white {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-light);
        }
        
        .nav-active {
            background-color: rgb(224 231 255);
            color: rgb(79 70 229);
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-active {
            background-color: #dcfce7;
            color: #16a34a;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }
        
        .status-expired {
            background-color: #fee2e2;
            color: #dc2626;
        }
        
        .connection-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .connected {
            background-color: var(--success);
        }
        
        .disconnected {
            background-color: var(--danger);
        }
        
        .scanning {
            background-color: var(--warning);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .input-field {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .page-section {
            display: none;
        }
        
        .active-section {
            display: block;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            background: var(--success);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .admin-table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .admin-table tr:hover {
            background-color: #f9fafb;
        }
        
        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            font-size: 14px;
        }
        
        .edit-btn {
            background: #e0e7ff;
            color: var(--primary);
        }
        
        .delete-btn {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex items-center text-indigo-600 font-bold text-xl cursor-pointer">
                        <span class="mr-2"><i class="fas fa-shield-alt"></i></span> OneXX Admin
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="connection-status" class="connection-status scanning"></span>
                    <span id="connection-text" class="text-sm text-gray-600">Scanning for data...</span>
                    <button id="nav-dashboard" class="px-3 py-2 rounded-md text-sm font-medium nav-active">
                        Dashboard
                    </button>
                    <button id="nav-guarantees" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-gray-100">
                        Guarantees
                    </button>
                    <button id="nav-settings" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-gray-100">
                        Settings
                    </button>
                    <button id="force-refresh" class="px-3 py-2 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">
                        <i class="fas fa-sync-alt mr-1"></i> Refresh
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-16">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="page-section active-section p-6">
            <div class="max-w-7xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Admin Dashboard</h1>
                
                <!-- Connection Status -->
                <div class="bg-white p-6 rounded-2xl shadow-md mb-8">
                    <div class="flex items-center mb-4">
                        <div class="mr-4">
                            <span id="connection-status-icon" class="connection-status scanning"></span>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium text-gray-900" id="connection-status-text">Checking connection to main website...</h3>
                            <p class="text-sm text-gray-600" id="data-status">No data received yet</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button id="scan-storage" class="bg-indigo-600 text-white font-medium py-2 px-4 rounded-md hover:bg-indigo-700 transition-all duration-300">
                            <i class="fas fa-search mr-2"></i> Scan Storage
                        </button>
                        <button id="import-demo" class="bg-green-600 text-white font-medium py-2 px-4 rounded-md hover:bg-green-700 transition-all duration-300">
                            <i class="fas fa-download mr-2"></i> Import Demo Data
                        </button>
                        <button id="clear-storage" class="bg-red-600 text-white font-medium py-2 px-4 rounded-md hover:bg-red-700 transition-all duration-300">
                            <i class="fas fa-trash mr-2"></i> Clear All Data
                        </button>
                    </div>
                </div>
                
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-indigo-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-file-contract text-indigo-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Total Guarantees</h2>
                                <p class="text-3xl font-bold text-gray-900" id="total-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-green-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Active Guarantees</h2>
                                <p class="text-3xl font-bold text-gray-900" id="active-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-yellow-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-clock text-yellow-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Pending Verification</h2>
                                <p class="text-3xl font-bold text-gray-900" id="pending-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-red-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-times-circle text-red-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Expired Guarantees</h2>
                                <p class="text-3xl font-bold text-gray-900" id="expired-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-xl font-bold text-gray-900">Recent Guarantees</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Certificate ID</th>
                                    <th>Seller</th>
                                    <th>Buyer</th>
                                    <th>Value</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recent-guarantees">
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-gray-500">No guarantees found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Guarantees Section -->
        <section id="guarantees-section" class="page-section p-6">
            <div class="max-w-7xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Manage Guarantees</h1>
                
                <!-- Data Management -->
                <div class="bg-white p-6 rounded-2xl shadow-md mb-8">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Data Management</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <button id="import-data" class="bg-blue-600 text-white font-medium py-2 px-4 rounded-md hover:bg-blue-700 transition-all duration-300">
                            <i class="fas fa-download mr-2"></i> Import Data
                        </button>
                        <button id="export-data" class="bg-green-600 text-white font-medium py-2 px-4 rounded-md hover:bg-green-700 transition-all duration-300">
                            <i class="fas fa-upload mr-2"></i> Export Data
                        </button>
                        <button id="add-guarantee" class="bg-indigo-600 text-white font-medium py-2 px-4 rounded-md hover:bg-indigo-700 transition-all duration-300">
                            <i class="fas fa-plus mr-2"></i> Add Guarantee
                        </button>
                        <button id="sync-data" class="bg-purple-600 text-white font-medium py-2 px-4 rounded-md hover:bg-purple-700 transition-all duration-300">
                            <i class="fas fa-sync-alt mr-2"></i> Sync Data
                        </button>
                    </div>
                    <p class="text-sm text-gray-600 mt-4" id="sync-status">Last sync: Never</p>
                </div>
                
                <!-- Guarantees Table -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-900">All Guarantees</h2>
                        <div class="flex items-center space-x-2">
                            <input type="text" id="search-guarantees" class="input-field" placeholder="Search..." style="width: 250px;">
                            <select id="filter-status" class="input-field" style="width: 150px;">
                                <option value="">All Statuses</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="expired">Expired</option>
                            </select>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Certificate ID</th>
                                    <th>Seller</th>
                                    <th>Buyer</th>
                                    <th>Value</th>
                                    <th>Created</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="all-guarantees">
                                <tr>
                                    <td colspan="7" class="text-center py-8 text-gray-500">No guarantees found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Settings Section -->
        <section id="settings-section" class="page-section p-6">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">System Settings</h1>
                
                <!-- Storage Configuration -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Storage Configuration</h2>
                        <p class="text-indigo-100 mt-1">Configure how data is shared with the main website</p>
                    </div>
                    <div class="px-6 py-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Storage Key Prefix
                            </label>
                            <input type="text" id="storage-prefix" value="onexx_" class="input-field">
                            <p class="text-xs text-gray-500 mt-1">This must match the prefix used on the main website</p>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Auto-Sync Interval (minutes)
                            </label>
                            <input type="number" id="sync-interval" value="5" min="1" class="input-field">
                            <p class="text-xs text-gray-500 mt-1">How often to automatically sync with main website (0 to disable)</p>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="save-storage" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Storage Settings
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Fee Structure -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Fee Structure</h2>
                        <p class="text-indigo-100 mt-1">Configure the guarantee fee calculation rules</p>
                    </div>
                    <div class="px-6 py-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Tier 1 (≤$40) Fee Percentage
                            </label>
                            <div class="flex items-center">
                                <input type="number" id="tier1-fee" value="5" min="0" max="100" class="input-field" style="width: 100px;">
                                <span class="ml-2 text-gray-700">%</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Tier 2 ($40.01-$160) Fee Percentage
                            </label>
                            <div class="flex items-center">
                                <input type="number" id="tier2-fee" value="3" min="0" max="100" class="input-field" style="width: 100px;">
                                <span class="ml-2 text-gray-700">%</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Tier 3 (≥$160.01) Fee Percentage
                            </label>
                            <div class="flex items-center">
                                <input type="number" id="tier3-fee" value="2" min="0" max="100" class="input-field" style="width: 100px;">
                                <span class="ml-2 text-gray-700">%</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Minimum Fee for Tier 3
                            </label>
                            <div class="flex items-center">
                                <span class="mr-2 text-gray-700">$</span>
                                <input type="number" id="min-tier3-fee" value="8" min="0" step="0.01" class="input-field" style="width: 100px;">
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="save-fees" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Fee Structure
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Methods -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Payment Methods</h2>
                        <p class="text-indigo-100 mt-1">Update payment method details</p>
                    </div>
                    <div class="px-6 py-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    bKash Number
                                </label>
                                <input type="text" id="bkash-number" value="01322149482" class="input-field">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Nagad Number
                                </label>
                                <input type="text" id="nagad-number" value="01322149482" class="input-field">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Rocket Number
                                </label>
                                <input type="text" id="rocket-number" value="01322149482" class="input-field">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    PayPal Email
                                </label>
                                <input type="email" id="paypal-email" value="payments@onexx.com" class="input-field">
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="save-payments" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Payment Methods
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sample Certificate -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Sample Certificate</h2>
                        <p class="text-indigo-100 mt-1">Customize the sample certificate on the homepage</p>
                    </div>
                    <div class="px-6 py-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Seller Name
                            </label>
                            <input type="text" id="sample-seller" value="John's Service" class="input-field">
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Buyer Name
                            </label>
                            <input type="text" id="sample-buyer" value="Jane Client" class="input-field">
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Service Value
                            </label>
                            <input type="text" id="sample-value" value="$1,500" class="input-field">
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Certificate ID
                            </label>
                            <input type="text" id="sample-certificate" value="OXX-123456-ABC789" class="input-field">
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="save-certificate" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Certificate Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        Settings saved successfully!
    </div>

    <!-- Guarantee Edit Modal -->
    <div class="modal" id="guarantee-modal">
        <div class="modal-content">
            <div class="modal-header border-b border-gray-200 pb-4 mb-4">
                <h3 class="text-xl font-bold text-gray-900" id="modal-title">Add Guarantee</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">&times;</button>
            </div>
            <div class="modal-body">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label>Certificate ID</label>
                        <input type="text" id="modal-certificate-id" class="input-field" placeholder="OXX-123456-ABC789">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="modal-status" class="input-field">
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="expired">Expired</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label>Seller Name</label>
                        <input type="text" id="modal-seller" class="input-field" placeholder="John's Service">
                    </div>
                    <div class="form-group">
                        <label>Buyer Name</label>
                        <input type="text" id="modal-buyer" class="input-field" placeholder="Jane Client">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label>Service Value</label>
                        <input type="text" id="modal-value" class="input-field" placeholder="$1,500.00">
                    </div>
                    <div class="form-group">
                        <label>Created Date</label>
                        <input type="date" id="modal-created" class="input-field">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button class="bg-gray-300 text-gray-700 font-medium py-2 px-6 rounded-md hover:bg-gray-400 close-modal">
                        Cancel
                    </button>
                    <button id="save-guarantee" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                        Save Guarantee
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage configuration
        let STORAGE_PREFIX = 'onexx_';
        const STORAGE_KEYS = {
            GUARANTEES: 'guarantees',
            FEES: 'fee_structure',
            PAYMENTS: 'payment_methods',
            CERTIFICATE: 'sample_certificate'
        };
        
        let currentEditingId = null;
        let syncInterval = null;
        
        // Initialize data
        function initializeData() {
            // Load configuration
            const config = JSON.parse(localStorage.getItem('onexx_admin_config') || '{}');
            if (config.storagePrefix) {
                STORAGE_PREFIX = config.storagePrefix;
                document.getElementById('storage-prefix').value = STORAGE_PREFIX;
            }
            if (config.syncInterval) {
                document.getElementById('sync-interval').value = config.syncInterval;
                setupSyncInterval(config.syncInterval);
            }
            
            // Load data from both admin and main site storage
            loadData();
            
            // Update connection status
            checkConnection();
        }
        
        // Check connection to main website data
        function checkConnection() {
            const mainSiteData = localStorage.getItem(STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES);
            const statusElement = document.getElementById('connection-status-icon');
            const statusText = document.getElementById('connection-status-text');
            const dataStatus = document.getElementById('data-status');
            
            if (mainSiteData) {
                const guarantees = JSON.parse(mainSiteData);
                statusElement.className = 'connection-status connected';
                statusText.textContent = 'Connected to main website data';
                dataStatus.textContent = `Found ${guarantees.length} guarantees from main site`;
            } else {
                // Check if we have admin data
                const adminData = localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES);
                if (adminData) {
                    statusElement.className = 'connection-status scanning';
                    statusText.textContent = 'Using admin data (main site not connected)';
                    dataStatus.textContent = 'Click "Export Data" to sync with main site';
                } else {
                    statusElement.className = 'connection-status disconnected';
                    statusText.textContent = 'No data found';
                    dataStatus.textContent = 'Import data or add new guarantees';
                }
            }
        }
        
        // Load data from localStorage
        function loadData() {
            // Try to get data from main site storage first
            let guarantees = JSON.parse(localStorage.getItem(STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES) || '[]');
            
            // If no data from main site, try admin storage
            if (guarantees.length === 0) {
                guarantees = JSON.parse(localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES) || '[]');
            }
            
            // Update stats
            document.getElementById('total-guarantees').textContent = guarantees.length;
            document.getElementById('active-guarantees').textContent = guarantees.filter(g => g.status === 'active').length;
            document.getElementById('pending-guarantees').textContent = guarantees.filter(g => g.status === 'pending').length;
            document.getElementById('expired-guarantees').textContent = guarantees.filter(g => g.status === 'expired').length;
            
            // Render recent guarantees (last 5)
            const recentGuarantees = guarantees.slice(-5).reverse();
            renderGuarantees(recentGuarantees, 'recent-guarantees');
            
            // Render all guarantees
            renderGuarantees(guarantees, 'all-guarantees');
            
            // Load fee structure
            let fees = JSON.parse(localStorage.getItem(STORAGE_PREFIX + STORAGE_KEYS.FEES) || '{}');
            if (Object.keys(fees).length === 0) {
                fees = JSON.parse(localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.FEES) || '{}');
            }
            document.getElementById('tier1-fee').value = fees.tier1 || 5;
            document.getElementById('tier2-fee').value = fees.tier2 || 3;
            document.getElementById('tier3-fee').value = fees.tier3 || 2;
            document.getElementById('min-tier3-fee').value = fees.minTier3 || 8;
            
            // Load payment methods
            let payments = JSON.parse(localStorage.getItem(STORAGE_PREFIX + STORAGE_KEYS.PAYMENTS) || '{}');
            if (Object.keys(payments).length === 0) {
                payments = JSON.parse(localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.PAYMENTS) || '{}');
            }
            document.getElementById('bkash-number').value = payments.bkash || '01322149482';
            document.getElementById('nagad-number').value = payments.nagad || '01322149482';
            document.getElementById('rocket-number').value = payments.rocket || '01322149482';
            document.getElementById('paypal-email').value = payments.paypal || 'payments@onexx.com';
            
            // Load sample certificate
            let certificate = JSON.parse(localStorage.getItem(STORAGE_PREFIX + STORAGE_KEYS.CERTIFICATE) || '{}');
            if (Object.keys(certificate).length === 0) {
                certificate = JSON.parse(localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.CERTIFICATE) || '{}');
            }
            document.getElementById('sample-seller').value = certificate.seller || 'John\'s Service';
            document.getElementById('sample-buyer').value = certificate.buyer || 'Jane Client';
            document.getElementById('sample-value').value = certificate.value || '$1,500';
            document.getElementById('sample-certificate').value = certificate.certificateId || 'OXX-123456-ABC789';
        }
        
        // Render guarantees to a table
        function renderGuarantees(guarantees, elementId) {
            const tbody = document.getElementById(elementId);
            
            if (guarantees.length === 0) {
                tbody.innerHTML = `<tr><td colspan="${elementId === 'all-guarantees' ? 7 : 6}" class="text-center py-8 text-gray-500">No guarantees found</td></tr>`;
                return;
            }
            
            tbody.innerHTML = '';
            
            guarantees.forEach(guarantee => {
                const row = document.createElement('tr');
                
                // Determine status class
                let statusClass = 'status-pending';
                if (guarantee.status === 'active') statusClass = 'status-active';
                if (guarantee.status === 'expired') statusClass = 'status-expired';
                
                row.innerHTML = `
                    <td class="font-mono">${guarantee.certificateId || 'N/A'}</td>
                    <td>${guarantee.seller || 'N/A'}</td>
                    <td>${guarantee.buyer || 'N/A'}</td>
                    <td>${guarantee.value || 'N/A'}</td>
                    ${elementId === 'all-guarantees' ? `<td>${guarantee.created || 'N/A'}</td>` : ''}
                    <td><span class="status-badge ${statusClass}">${guarantee.status ? guarantee.status.charAt(0).toUpperCase() + guarantee.status.slice(1) : 'Unknown'}</span></td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${guarantee.id}">Edit</button>
                        <button class="action-btn delete-btn" data-id="${guarantee.id}">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll(`#${elementId} .edit-btn`).forEach(btn => {
                btn.addEventListener('click', () => editGuarantee(btn.dataset.id));
            });
            
            document.querySelectorAll(`#${elementId} .delete-btn`).forEach(btn => {
                btn.addEventListener('click', () => deleteGuarantee(btn.dataset.id));
            });
        }
        
        // Show notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = isError ? '#ef4444' : '#10b981';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Save fee structure
        function saveFeeStructure() {
            const feeStructure = {
                tier1: parseInt(document.getElementById('tier1-fee').value),
                tier2: parseInt(document.getElementById('tier2-fee').value),
                tier3: parseInt(document.getElementById('tier3-fee').value),
                minTier3: parseFloat(document.getElementById('min-tier3-fee').value)
            };
            
            // Save to both admin and main site storage
            localStorage.setItem(STORAGE_PREFIX + STORAGE_KEYS.FEES, JSON.stringify(feeStructure));
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.FEES, JSON.stringify(feeStructure));
            
            showNotification('Fee structure saved successfully!');
        }
        
        // Save payment methods
        function savePaymentMethods() {
            const paymentMethods = {
                bkash: document.getElementById('bkash-number').value,
                nagad: document.getElementById('nagad-number').value,
                rocket: document.getElementById('rocket-number').value,
                paypal: document.getElementById('paypal-email').value
            };
            
            // Save to both admin and main site storage
            localStorage.setItem(STORAGE_PREFIX + STORAGE_KEYS.PAYMENTS, JSON.stringify(paymentMethods));
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.PAYMENTS, JSON.stringify(paymentMethods));
            
            showNotification('Payment methods saved successfully!');
        }
        
        // Save sample certificate
        function saveSampleCertificate() {
            const certificate = {
                seller: document.getElementById('sample-seller').value,
                buyer: document.getElementById('sample-buyer').value,
                value: document.getElementById('sample-value').value,
                certificateId: document.getElementById('sample-certificate').value
            };
            
            // Save to both admin and main site storage
            localStorage.setItem(STORAGE_PREFIX + STORAGE_KEYS.CERTIFICATE, JSON.stringify(certificate));
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.CERTIFICATE, JSON.stringify(certificate));
            
            showNotification('Certificate settings saved successfully!');
        }
        
        // Save storage configuration
        function saveStorageConfig() {
            const storagePrefix = document.getElementById('storage-prefix').value;
            const syncIntervalValue = parseInt(document.getElementById('sync-interval').value);
            
            STORAGE_PREFIX = storagePrefix;
            
            const config = {
                storagePrefix: storagePrefix,
                syncInterval: syncIntervalValue
            };
            
            localStorage.setItem('onexx_admin_config', JSON.stringify(config));
            setupSyncInterval(syncIntervalValue);
            
            showNotification('Storage configuration saved successfully!');
            checkConnection();
        }
        
        // Set up sync interval
        function setupSyncInterval(minutes) {
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            if (minutes > 0) {
                syncInterval = setInterval(() => {
                    syncData();
                }, minutes * 60 * 1000);
            }
        }
        
        // Import data from main site
        function importData() {
            let imported = false;
            
            for (const key of Object.values(STORAGE_KEYS)) {
                const mainSiteData = localStorage.getItem(STORAGE_PREFIX + key);
                if (mainSiteData) {
                    localStorage.setItem('admin_' + STORAGE_PREFIX + key, mainSiteData);
                    imported = true;
                }
            }
            
            if (imported) {
                showNotification('Data imported successfully from main website!');
                loadData();
            } else {
                showNotification('No data found from main website', true);
            }
        }
        
        // Export data to main site
        function exportData() {
            let exported = false;
            
            for (const key of Object.values(STORAGE_KEYS)) {
                const adminData = localStorage.getItem('admin_' + STORAGE_PREFIX + key);
                if (adminData) {
                    localStorage.setItem(STORAGE_PREFIX + key, adminData);
                    exported = true;
                }
            }
            
            if (exported) {
                showNotification('Data exported successfully to main website!');
                checkConnection();
            } else {
                showNotification('No admin data found to export', true);
            }
        }
        
        // Sync data both ways
        function syncData() {
            let changes = false;
            
            for (const key of Object.values(STORAGE_KEYS)) {
                const mainSiteData = localStorage.getItem(STORAGE_PREFIX + key);
                const adminData = localStorage.getItem('admin_' + STORAGE_PREFIX + key);
                
                // If both have data, use the most recent
                if (mainSiteData && adminData) {
                    try {
                        // For simplicity, just use admin data if it exists
                        localStorage.setItem(STORAGE_PREFIX + key, adminData);
                        changes = true;
                    } catch (e) {
                        console.error('Error parsing data:', e);
                    }
                } 
                // If only main site has data, import it
                else if (mainSiteData) {
                    localStorage.setItem('admin_' + STORAGE_PREFIX + key, mainSiteData);
                    changes = true;
                }
                // If only admin has data, export it
                else if (adminData) {
                    localStorage.setItem(STORAGE_PREFIX + key, adminData);
                    changes = true;
                }
            }
            
            if (changes) {
                showNotification('Data synchronized successfully!');
                document.getElementById('sync-status').textContent = `Last sync: ${new Date().toLocaleString()}`;
                loadData();
            } else {
                showNotification('No changes to synchronize');
            }
        }
        
        // Add new guarantee
        function addGuarantee() {
            // Reset modal fields
            document.getElementById('modal-title').textContent = 'Add Guarantee';
            document.getElementById('modal-certificate-id').value = '';
            document.getElementById('modal-seller').value = '';
            document.getElementById('modal-buyer').value = '';
            document.getElementById('modal-value').value = '';
            document.getElementById('modal-status').value = 'active';
            document.getElementById('modal-created').value = new Date().toISOString().split('T')[0];
            
            currentEditingId = null;
            
            // Show modal
            document.getElementById('guarantee-modal').style.display = 'flex';
        }
        
        // Edit guarantee
        function editGuarantee(id) {
            const guarantees = JSON.parse(localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES) || '[]');
            const guarantee = guarantees.find(g => g.id === parseInt(id));
            
            if (!guarantee) return;
            
            // Fill modal fields
            document.getElementById('modal-title').textContent = 'Edit Guarantee';
            document.getElementById('modal-certificate-id').value = guarantee.certificateId || '';
            document.getElementById('modal-seller').value = guarantee.seller || '';
            document.getElementById('modal-buyer').value = guarantee.buyer || '';
            document.getElementById('modal-value').value = guarantee.value || '';
            document.getElementById('modal-status').value = guarantee.status || 'active';
            document.getElementById('modal-created').value = guarantee.created || new Date().toISOString().split('T')[0];
            
            currentEditingId = parseInt(id);
            
            // Show modal
            document.getElementById('guarantee-modal').style.display = 'flex';
        }
        
        // Save guarantee
        function saveGuarantee() {
            const guarantees = JSON.parse(localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES) || '[]');
            
            const guaranteeData = {
                certificateId: document.getElementById('modal-certificate-id').value,
                seller: document.getElementById('modal-seller').value,
                buyer: document.getElementById('modal-buyer').value,
                value: document.getElementById('modal-value').value,
                status: document.getElementById('modal-status').value,
                created: document.getElementById('modal-created').value
            };
            
            if (currentEditingId === null) {
                // Add new guarantee
                const newId = guarantees.length > 0 ? Math.max(...guarantees.map(g => g.id)) + 1 : 1;
                guaranteeData.id = newId;
                guarantees.push(guaranteeData);
            } else {
                // Update existing guarantee
                const index = guarantees.findIndex(g => g.id === currentEditingId);
                if (index !== -1) {
                    guaranteeData.id = currentEditingId;
                    guarantees[index] = guaranteeData;
                }
            }
            
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES, JSON.stringify(guarantees));
            
            // Reload data and close modal
            loadData();
            document.getElementById('guarantee-modal').style.display = 'none';
            showNotification('Guarantee saved successfully!');
        }
        
        // Delete guarantee
        function deleteGuarantee(id) {
            if (!confirm('Are you sure you want to delete this guarantee?')) return;
            
            const guarantees = JSON.parse(localStorage.getItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES) || '[]');
            const filteredGuarantees = guarantees.filter(g => g.id !== parseInt(id));
            
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES, JSON.stringify(filteredGuarantees));
            loadData();
            showNotification('Guarantee deleted successfully!');
        }
        
        // Import demo data
        function importDemoData() {
            // Demo guarantees
            const demoGuarantees = [
                {
                    id: 1,
                    certificateId: 'OXX-987654-XYZ',
                    seller: 'John\'s Service',
                    buyer: 'Jane Client',
                    value: '$1,200.00',
                    status: 'active',
                    created: '2023-10-15'
                },
                {
                    id: 2,
                    certificateId: 'OXX-987653-XYZ',
                    seller: 'Mike\'s Repairs',
                    buyer: 'Sarah Johnson',
                    value: '$850.00',
                    status: 'pending',
                    created: '2023-10-14'
                }
            ];
            
            // Demo fee structure
            const demoFees = {
                tier1: 5,
                tier2: 3,
                tier3: 2,
                minTier3: 8
            };
            
            // Demo payment methods
            const demoPayments = {
                bkash: '01322149482',
                nagad: '01322149482',
                rocket: '01322149482',
                paypal: 'payments@onexx.com'
            };
            
            // Demo certificate
            const demoCertificate = {
                seller: 'John\'s Service',
                buyer: 'Jane Client',
                value: '$1,500',
                certificateId: 'OXX-123456-ABC789'
            };
            
            // Save to admin storage
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.GUARANTEES, JSON.stringify(demoGuarantees));
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.FEES, JSON.stringify(demoFees));
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.PAYMENTS, JSON.stringify(demoPayments));
            localStorage.setItem('admin_' + STORAGE_PREFIX + STORAGE_KEYS.CERTIFICATE, JSON.stringify(demoCertificate));
            
            showNotification('Demo data imported successfully!');
            loadData();
        }
        
        // Clear all storage
        function clearStorage() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                // Clear all possible keys
                for (const key of Object.values(STORAGE_KEYS)) {
                    localStorage.removeItem(STORAGE_PREFIX + key);
                    localStorage.removeItem('admin_' + STORAGE_PREFIX + key);
                }
                
                showNotification('All data cleared successfully!');
                loadData();
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data
            initializeData();
            
            // Set up navigation
            const navDashboard = document.getElementById('nav-dashboard');
            const navGuarantees = document.getElementById('nav-guarantees');
            const navSettings = document.getElementById('nav-settings');
            
            const dashboardSection = document.getElementById('dashboard-section');
            const guaranteesSection = document.getElementById('guarantees-section');
            const settingsSection = document.getElementById('settings-section');
            
            // Function to change active section
            function changeActiveSection(section) {
                // Hide all sections
                dashboardSection.classList.remove('active-section');
                guaranteesSection.classList.remove('active-section');
                settingsSection.classList.remove('active-section');
                
                // Remove active class from all nav buttons
                navDashboard.classList.remove('nav-active');
                navGuarantees.classList.remove('nav-active');
                navSettings.classList.remove('nav-active');
                
                // Show the selected section
                section.classList.add('active-section');
                
                // Add active class to the corresponding nav button
                if (section === dashboardSection) {
                    navDashboard.classList.add('nav-active');
                } else if (section === guaranteesSection) {
                    navGuarantees.classList.add('nav-active');
                } else if (section === settingsSection) {
                    navSettings.classList.add('nav-active');
                }
            }
            
            // Add event listeners to navigation buttons
            navDashboard.addEventListener('click', function() {
                changeActiveSection(dashboardSection);
            });
            
            navGuarantees.addEventListener('click', function() {
                changeActiveSection(guaranteesSection);
            });
            
            navSettings.addEventListener('click', function() {
                changeActiveSection(settingsSection);
            });
            
            // Save buttons functionality
            document.getElementById('save-fees').addEventListener('click', saveFeeStructure);
            document.getElementById('save-payments').addEventListener('click', savePaymentMethods);
            document.getElementById('save-certificate').addEventListener('click', saveSampleCertificate);
            document.getElementById('save-storage').addEventListener('click', saveStorageConfig);
            
            // Data management buttons
            document.getElementById('import-data').addEventListener('click', importData);
            document.getElementById('export-data').addEventListener('click', exportData);
            document.getElementById('sync-data').addEventListener('click', syncData);
            document.getElementById('add-guarantee').addEventListener('click', addGuarantee);
            document.getElementById('force-refresh').addEventListener('click', function() {
                loadData();
                showNotification('Data refreshed successfully!');
            });
            
            // Troubleshooting buttons
            document.getElementById('scan-storage').addEventListener('click', function() {
                // Just refresh data for now
                loadData();
                showNotification('Storage scanned successfully!');
            });
            
            document.getElementById('import-demo').addEventListener('click', importDemoData);
            document.getElementById('clear-storage').addEventListener('click', clearStorage);
            
            // Modal functionality
            document.getElementById('save-guarantee').addEventListener('click', saveGuarantee);
            
            // Close modal buttons
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('guarantee-modal').style.display = 'none';
                });
            });
            
            // Check connection every 5 seconds
            setInterval(checkConnection, 5000);
        });
    </script>
</body>
</html>
