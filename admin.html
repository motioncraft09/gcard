<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slipzy • Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6C63FF;
            --primary-light: #8B85FF;
            --primary-dark: #554FD8;
            --primary-gradient: linear-gradient(135deg, #6C63FF 0%, #8B85FF 100%);
            --primary-gradient-hover: linear-gradient(135deg, #554FD8 0%, #6C63FF 100%);
            --text: #1D1D1F;
            --text-light: #86868B;
            --text-lighter: #AEAEB2;
            --bg: #FFFFFF;
            --card-bg: #FFFFFF;
            --card-bg-hover: #FBFBFD;
            --border: #F2F2F7;
            --border-hover: #E5E5EA;
            --radius: 20px;
            --radius-sm: 12px;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 16px 48px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 32px 96px rgba(0, 0, 0, 0.16);
            --spacing-xs: 0.75rem;
            --spacing-sm: 1.25rem;
            --spacing-md: 2rem;
            --spacing-lg: 3rem;
            --spacing-xl: 5rem;
            --ease: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --success: #34C759;
            --warning: #FF9500;
            --error: #FF3B30;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #F5F7FA 0%, #FBFBFD 100%);
            min-height: 100vh;
            overflow-x: hidden;
            font-synthesis: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: var(--spacing-lg);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .admin-badge {
            background: var(--error);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: var(--spacing-xs);
        }

        .nav {
            display: flex;
            gap: var(--spacing-md);
        }

        .nav-link {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            transition: all 0.3s var(--ease);
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-md);
            transition: all 0.5s var(--ease);
            border: 1px solid var(--border);
            backdrop-filter: blur(40px);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            border-color: var(--border-hover);
            background: var(--card-bg-hover);
            transform: translateY(-4px);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            letter-spacing: -0.01em;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-card {
            text-align: center;
            padding: var(--spacing-lg);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: var(--spacing-xs);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-light);
            font-weight: 600;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--border);
            border-radius: var(--radius-sm);
            padding: 4px;
            margin-bottom: var(--spacing-md);
            gap: 4px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 700;
            border-radius: var(--radius-sm);
            transition: all 0.4s var(--ease);
            text-align: center;
            color: var(--text-light);
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .tab.active {
            background: var(--bg);
            color: var(--text);
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s var(--ease);
        }

        .tab-content.active {
            display: block;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: rgba(108, 99, 255, 0.05);
            font-weight: 700;
            color: var(--text);
            font-size: 0.9rem;
        }

        tr:hover {
            background: rgba(108, 99, 255, 0.02);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .badge-success {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success);
            border: 1px solid rgba(52, 199, 89, 0.2);
        }

        .badge-warning {
            background: rgba(255, 149, 0, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 149, 0, 0.2);
        }

        .badge-error {
            background: rgba(255, 59, 48, 0.1);
            color: var(--error);
            border: 1px solid rgba(255, 59, 48, 0.2);
        }

        .badge-primary {
            background: rgba(108, 99, 255, 0.1);
            color: var(--primary);
            border: 1px solid rgba(108, 99, 255, 0.2);
        }

        /* Buttons */
        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 10px 18px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s var(--ease);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            position: relative;
            overflow: hidden;
            letter-spacing: -0.01em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            background: var(--primary-gradient-hover);
        }

        .btn-sm {
            padding: 8px 14px;
            font-size: 0.8rem;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #2CA24D;
        }

        .btn-error {
            background: var(--error);
        }

        .btn-error:hover {
            background: #D70015;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #E68500;
        }

        /* Forms */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 700;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s var(--ease);
            background: var(--bg);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s var(--ease);
            background: var(--bg);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1);
        }

        /* Actions */
        .actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        /* Alerts */
        .alert {
            padding: var(--spacing-md);
            border-radius: var(--radius);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .alert-success {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.2);
            color: var(--success);
        }

        .alert-error {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.2);
            color: var(--error);
        }

        .alert-warning {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid rgba(255, 149, 0, 0.2);
            color: var(--warning);
        }

        /* Login Form */
        .login-container {
            max-width: 400px;
            margin: var(--spacing-xl) auto;
            padding: var(--spacing-lg);
        }

        .login-title {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            font-size: 1.5rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (min-width: 768px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (max-width: 767px) {
            .container {
                padding: 0 var(--spacing-sm);
            }
            
            .header {
                flex-direction: column;
                gap: var(--spacing-sm);
                text-align: center;
            }
            
            .nav {
                width: 100%;
                justify-content: center;
            }
            
            .card {
                padding: var(--spacing-sm);
            }
            
            th, td {
                padding: 12px 8px;
            }
            
            .actions {
                flex-direction: column;
            }
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(108, 99, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Hidden */
        .hidden {
            display: none;
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .search-input {
            flex: 1;
        }

        /* Code Display */
        .code-display {
            background: #1D1D1F;
            color: #34C759;
            padding: var(--spacing-md);
            border-radius: var(--radius);
            font-family: monospace;
            font-size: 1rem;
            margin-bottom: var(--spacing-md);
            overflow-x: auto;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: var(--spacing-md);
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            color: var(--text);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="container">
            <div class="card login-container">
                <h1 class="login-title">Slipzy Admin</h1>
                <form class="login-form" id="login-form">
                    <div class="form-group">
                        <label class="form-label" for="admin-username">Username</label>
                        <input type="text" id="admin-username" class="form-input" placeholder="Enter admin username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="admin-password">Password</label>
                        <input type="password" id="admin-password" class="form-input" placeholder="Enter admin password" required>
                    </div>
                    <button type="submit" class="btn btn-full">Login to Admin Panel</button>
                </form>
                <div id="login-error" class="alert alert-error hidden" style="margin-top: var(--spacing-md);">
                    Invalid username or password. Please try again.
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden">
        <div class="container">
            <div class="header">
                <div class="logo">
                    Slipzy <span class="admin-badge">ADMIN</span>
                </div>
                <div class="nav">
                    <a href="#" class="nav-link active" data-tab="dashboard">Dashboard</a>
                    <a href="#" class="nav-link" data-tab="users">Users</a>
                    <a href="#" class="nav-link" data-tab="codes">Unlock Codes</a>
                    <a href="#" class="nav-link" data-tab="transactions">Transactions</a>
                    <a href="#" class="nav-link" data-tab="settings">Settings</a>
                    <a href="#" class="nav-link" id="logout-btn">Logout</a>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard-tab">
                <h1 class="card-title">Admin Dashboard</h1>
                
                <div class="stats-grid">
                    <div class="card stat-card">
                        <div class="stat-number" id="total-users">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-number" id="active-users">0</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-number" id="total-slips">0</div>
                        <div class="stat-label">Slips Generated</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-number" id="total-revenue">$0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>

                <div class="grid">
                    <div class="card">
                        <h2 class="card-title">Recent Activity</h2>
                        <div class="table-container">
                            <table id="recent-activity-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-activity-body">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Quick Actions</h2>
                        <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                            <button class="btn" id="generate-code-btn">Generate Unlock Code</button>
                            <button class="btn btn-success" id="view-users-btn">View All Users</button>
                            <button class="btn btn-warning" id="view-transactions-btn">View Transactions</button>
                            <button class="btn btn-error" id="clear-data-btn">Clear All Data</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div class="tab-content" id="users-tab">
                <h1 class="card-title">User Management</h1>
                
                <div class="search-bar">
                    <input type="text" id="user-search" class="form-input search-input" placeholder="Search users by fingerprint...">
                    <button class="btn" id="search-user-btn">Search</button>
                </div>
                
                <div class="card">
                    <div class="table-container">
                        <table id="users-table">
                            <thead>
                                <tr>
                                    <th>Fingerprint</th>
                                    <th>Usage Count</th>
                                    <th>Unlocked</th>
                                    <th>Last Active</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Unlock Codes Tab -->
            <div class="tab-content" id="codes-tab">
                <h1 class="card-title">Unlock Code Management</h1>
                
                <div class="card" style="margin-bottom: var(--spacing-md);">
                    <h2 class="card-title">Generate New Code</h2>
                    <div class="grid">
                        <div class="form-group">
                            <label class="form-label" for="code-type">Code Type</label>
                            <select id="code-type" class="form-select">
                                <option value="single">Single Use</option>
                                <option value="multi">Multi-Use (10 users)</option>
                                <option value="unlimited">Unlimited Use</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="code-validity">Validity (Days)</label>
                            <input type="number" id="code-validity" class="form-input" value="30" min="1" max="365">
                        </div>
                    </div>
                    <button class="btn" id="generate-unlock-code">Generate Code</button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Active Unlock Codes</h2>
                    <div class="table-container">
                        <table id="codes-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Type</th>
                                    <th>Uses</th>
                                    <th>Max Uses</th>
                                    <th>Expires</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="codes-table-body">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div class="tab-content" id="transactions-tab">
                <h1 class="card-title">Transaction Management</h1>
                
                <div class="search-bar">
                    <input type="text" id="transaction-search" class="form-input search-input" placeholder="Search transactions by ID...">
                    <button class="btn" id="search-transaction-btn">Search</button>
                </div>
                
                <div class="card">
                    <div class="table-container">
                        <table id="transactions-table">
                            <thead>
                                <tr>
                                    <th>Transaction ID</th>
                                    <th>User Fingerprint</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table-body">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <h1 class="card-title">Admin Settings</h1>
                
                <div class="grid">
                    <div class="card">
                        <h2 class="card-title">Security Settings</h2>
                        <div class="form-group">
                            <label class="form-label" for="admin-password-change">Change Admin Password</label>
                            <input type="password" id="admin-password-change" class="form-input" placeholder="New password">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="admin-password-confirm">Confirm New Password</label>
                            <input type="password" id="admin-password-confirm" class="form-input" placeholder="Confirm new password">
                        </div>
                        <button class="btn" id="change-password-btn">Change Password</button>
                    </div>
                    
                    <div class="card">
                        <h2 class="card-title">System Settings</h2>
                        <div class="form-group">
                            <label class="form-label" for="free-slips-limit">Free Slips Limit</label>
                            <input type="number" id="free-slips-limit" class="form-input" value="10" min="1" max="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="premium-price">Premium Price (USD)</label>
                            <input type="number" id="premium-price" class="form-input" value="1" min="1" max="100" step="0.01">
                        </div>
                        <button class="btn" id="save-settings-btn">Save Settings</button>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Danger Zone</h2>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                        <button class="btn btn-warning" id="export-data-btn">Export All Data</button>
                        <button class="btn btn-error" id="reset-system-btn">Reset System</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Generated Code Modal -->
    <div class="modal-overlay" id="code-modal">
        <div class="modal-content">
            <button class="modal-close" id="close-code-modal">×</button>
            <h2 class="modal-title">Unlock Code Generated</h2>
            <p>Your new unlock code has been generated successfully. Share this code with users to grant them premium access.</p>
            <div class="code-display" id="generated-code">SLIPZY-XXXX-XXXX-XXXX</div>
            <p><strong>Code Type:</strong> <span id="code-type-display">Single Use</span></p>
            <p><strong>Expires:</strong> <span id="code-expiry-display">30 days from now</span></p>
            <button class="btn btn-full" id="copy-code-btn">Copy Code</button>
        </div>
    </div>

    <script>
        // Admin Panel JavaScript
        
        // Global variables
        let adminData = {
            users: [],
            unlockCodes: [],
            transactions: [],
            settings: {
                freeSlipsLimit: 10,
                premiumPrice: 1,
                adminPassword: 'admin123' // Default password
            },
            activityLog: []
        };
        
        // DOM elements
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const logoutBtn = document.getElementById('logout-btn');
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Dashboard elements
        const totalUsersEl = document.getElementById('total-users');
        const activeUsersEl = document.getElementById('active-users');
        const totalSlipsEl = document.getElementById('total-slips');
        const totalRevenueEl = document.getElementById('total-revenue');
        const recentActivityBody = document.getElementById('recent-activity-body');
        const generateCodeBtn = document.getElementById('generate-code-btn');
        const viewUsersBtn = document.getElementById('view-users-btn');
        const viewTransactionsBtn = document.getElementById('view-transactions-btn');
        const clearDataBtn = document.getElementById('clear-data-btn');
        
        // Users tab elements
        const userSearch = document.getElementById('user-search');
        const searchUserBtn = document.getElementById('search-user-btn');
        const usersTableBody = document.getElementById('users-table-body');
        
        // Codes tab elements
        const codeType = document.getElementById('code-type');
        const codeValidity = document.getElementById('code-validity');
        const generateUnlockCodeBtn = document.getElementById('generate-unlock-code');
        const codesTableBody = document.getElementById('codes-table-body');
        
        // Transactions tab elements
        const transactionSearch = document.getElementById('transaction-search');
        const searchTransactionBtn = document.getElementById('search-transaction-btn');
        const transactionsTableBody = document.getElementById('transactions-table-body');
        
        // Settings tab elements
        const adminPasswordChange = document.getElementById('admin-password-change');
        const adminPasswordConfirm = document.getElementById('admin-password-confirm');
        const changePasswordBtn = document.getElementById('change-password-btn');
        const freeSlipsLimit = document.getElementById('free-slips-limit');
        const premiumPrice = document.getElementById('premium-price');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const exportDataBtn = document.getElementById('export-data-btn');
        const resetSystemBtn = document.getElementById('reset-system-btn');
        
        // Modal elements
        const codeModal = document.getElementById('code-modal');
        const closeCodeModal = document.getElementById('close-code-modal');
        const generatedCode = document.getElementById('generated-code');
        const codeTypeDisplay = document.getElementById('code-type-display');
        const codeExpiryDisplay = document.getElementById('code-expiry-display');
        const copyCodeBtn = document.getElementById('copy-code-btn');
        
        // Initialize the admin panel
        document.addEventListener('DOMContentLoaded', function() {
            // Load admin data from localStorage
            loadAdminData();
            
            // Set up event listeners
            setupEventListeners();
            
            // If already logged in, show admin panel
            if (localStorage.getItem('slipzy_admin_logged_in') === 'true') {
                showAdminPanel();
            }
        });
        
        function loadAdminData() {
            const storedData = localStorage.getItem('slipzy_admin_data');
            if (storedData) {
                try {
                    adminData = JSON.parse(storedData);
                } catch (e) {
                    console.error('Error parsing admin data:', e);
                    // Initialize with default data
                    initializeDefaultAdminData();
                }
            } else {
                // Initialize with default data
                initializeDefaultAdminData();
            }
            
            // Also load user data from main app
            loadUserDataFromMainApp();
        }
        
        function initializeDefaultAdminData() {
            adminData = {
                users: [],
                unlockCodes: [],
                transactions: [],
                settings: {
                    freeSlipsLimit: 10,
                    premiumPrice: 1,
                    adminPassword: 'admin123'
                },
                activityLog: []
            };
            
            saveAdminData();
        }
        
        function loadUserDataFromMainApp() {
            // Try to load user data from the main app's localStorage
            try {
                // Get all keys from localStorage
                const keys = Object.keys(localStorage);
                
                // Look for user data keys
                keys.forEach(key => {
                    if (key.startsWith('slipzy_secure_data_usageCount_')) {
                        const fingerprint = key.replace('slipzy_secure_data_usageCount_', '');
                        
                        // Check if user already exists in admin data
                        const existingUser = adminData.users.find(u => u.fingerprint === fingerprint);
                        
                        if (!existingUser) {
                            // Get usage count
                            const usageCount = parseInt(localStorage.getItem(key)) || 0;
                            
                            // Check if user is unlocked
                            const unlockedUsers = JSON.parse(localStorage.getItem('slipzy_secure_data_unlockedUsers') || '[]');
                            const isUnlocked = unlockedUsers.includes(fingerprint);
                            
                            // Add user to admin data
                            adminData.users.push({
                                fingerprint: fingerprint,
                                usageCount: usageCount,
                                isUnlocked: isUnlocked,
                                lastActive: Date.now()
                            });
                        }
                    }
                });
                
                // Save updated admin data
                saveAdminData();
            } catch (e) {
                console.error('Error loading user data from main app:', e);
            }
        }
        
        function saveAdminData() {
            localStorage.setItem('slipzy_admin_data', JSON.stringify(adminData));
        }
        
        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', handleLogin);
            
            // Logout button
            logoutBtn.addEventListener('click', handleLogout);
            
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (this.id !== 'logout-btn') {
                        switchTab(this.getAttribute('data-tab'));
                    }
                });
            });
            
            // Dashboard buttons
            generateCodeBtn.addEventListener('click', function() {
                switchTab('codes');
            });
            
            viewUsersBtn.addEventListener('click', function() {
                switchTab('users');
            });
            
            viewTransactionsBtn.addEventListener('click', function() {
                switchTab('transactions');
            });
            
            clearDataBtn.addEventListener('click', clearAllData);
            
            // Users tab
            searchUserBtn.addEventListener('click', searchUsers);
            userSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchUsers();
                }
            });
            
            // Codes tab
            generateUnlockCodeBtn.addEventListener('click', generateUnlockCode);
            
            // Transactions tab
            searchTransactionBtn.addEventListener('click', searchTransactions);
            transactionSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchTransactions();
                }
            });
            
            // Settings tab
            changePasswordBtn.addEventListener('click', changeAdminPassword);
            saveSettingsBtn.addEventListener('click', saveSettings);
            exportDataBtn.addEventListener('click', exportAllData);
            resetSystemBtn.addEventListener('click', resetSystem);
            
            // Modal
            closeCodeModal.addEventListener('click', function() {
                codeModal.style.display = 'none';
            });
            
            copyCodeBtn.addEventListener('click', copyCodeToClipboard);
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === codeModal) {
                    codeModal.style.display = 'none';
                }
            });
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // Simple authentication (in a real app, this would be more secure)
            if (username === 'admin' && password === adminData.settings.adminPassword) {
                // Successful login
                localStorage.setItem('slipzy_admin_logged_in', 'true');
                showAdminPanel();
            } else {
                // Failed login
                loginError.classList.remove('hidden');
            }
        }
        
        function handleLogout() {
            localStorage.removeItem('slipzy_admin_logged_in');
            showLoginScreen();
        }
        
        function showLoginScreen() {
            loginScreen.classList.remove('hidden');
            adminPanel.classList.add('hidden');
            loginForm.reset();
            loginError.classList.add('hidden');
        }
        
        function showAdminPanel() {
            loginScreen.classList.add('hidden');
            adminPanel.classList.remove('hidden');
            
            // Update dashboard
            updateDashboard();
            
            // Load initial tab data
            switchTab('dashboard');
        }
        
        function switchTab(tabName) {
            // Update navigation
            navLinks.forEach(link => {
                if (link.getAttribute('data-tab') === tabName) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Update tab contents
            tabContents.forEach(content => {
                if (content.id === `${tabName}-tab`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            // Load tab-specific data
            switch(tabName) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'users':
                    loadUsersTable();
                    break;
                case 'codes':
                    loadCodesTable();
                    break;
                case 'transactions':
                    loadTransactionsTable();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }
        
        function updateDashboard() {
            // Update stats
            totalUsersEl.textContent = adminData.users.length;
            
            const activeUsers = adminData.users.filter(user => {
                // Users active in the last 30 days
                return Date.now() - user.lastActive < 30 * 24 * 60 * 60 * 1000;
            }).length;
            activeUsersEl.textContent = activeUsers;
            
            const totalSlips = adminData.users.reduce((total, user) => total + user.usageCount, 0);
            totalSlipsEl.textContent = totalSlips;
            
            const totalRevenue = adminData.transactions.reduce((total, transaction) => {
                if (transaction.status === 'completed') {
                    return total + transaction.amount;
                }
                return total;
            }, 0);
            totalRevenueEl.textContent = `$${totalRevenue.toFixed(2)}`;
            
            // Update recent activity
            updateRecentActivity();
        }
        
        function updateRecentActivity() {
            recentActivityBody.innerHTML = '';
            
            // Show latest 10 activities
            const recentActivities = adminData.activityLog
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 10);
            
            if (recentActivities.length === 0) {
                recentActivityBody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--text-light);">No recent activity</td></tr>';
                return;
            }
            
            recentActivities.forEach(activity => {
                const row = document.createElement('tr');
                
                const userCell = document.createElement('td');
                userCell.textContent = activity.userFingerprint ? 
                    activity.userFingerprint.substring(0, 8) + '...' : 'System';
                
                const actionCell = document.createElement('td');
                actionCell.textContent = activity.action;
                
                const dateCell = document.createElement('td');
                dateCell.textContent = new Date(activity.timestamp).toLocaleDateString();
                
                row.appendChild(userCell);
                row.appendChild(actionCell);
                row.appendChild(dateCell);
                
                recentActivityBody.appendChild(row);
            });
        }
        
        function loadUsersTable() {
            usersTableBody.innerHTML = '';
            
            if (adminData.users.length === 0) {
                usersTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-light);">No users found</td></tr>';
                return;
            }
            
            adminData.users.forEach(user => {
                const row = document.createElement('tr');
                
                const fingerprintCell = document.createElement('td');
                fingerprintCell.textContent = user.fingerprint;
                
                const usageCell = document.createElement('td');
                usageCell.textContent = user.usageCount;
                
                const unlockedCell = document.createElement('td');
                const unlockedBadge = document.createElement('span');
                unlockedBadge.className = user.isUnlocked ? 'badge badge-success' : 'badge badge-error';
                unlockedBadge.textContent = user.isUnlocked ? 'Yes' : 'No';
                unlockedCell.appendChild(unlockedBadge);
                
                const lastActiveCell = document.createElement('td');
                lastActiveCell.textContent = new Date(user.lastActive).toLocaleDateString();
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'actions';
                
                const unlockBtn = document.createElement('button');
                unlockBtn.className = 'btn btn-sm ' + (user.isUnlocked ? 'btn-error' : 'btn-success');
                unlockBtn.textContent = user.isUnlocked ? 'Revoke' : 'Unlock';
                unlockBtn.addEventListener('click', function() {
                    toggleUserUnlock(user.fingerprint);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-sm btn-error';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', function() {
                    deleteUser(user.fingerprint);
                });
                
                actionsCell.appendChild(unlockBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(fingerprintCell);
                row.appendChild(usageCell);
                row.appendChild(unlockedCell);
                row.appendChild(lastActiveCell);
                row.appendChild(actionsCell);
                
                usersTableBody.appendChild(row);
            });
        }
        
        function searchUsers() {
            const searchTerm = userSearch.value.trim().toLowerCase();
            
            if (!searchTerm) {
                loadUsersTable();
                return;
            }
            
            const filteredUsers = adminData.users.filter(user => 
                user.fingerprint.toLowerCase().includes(searchTerm)
            );
            
            usersTableBody.innerHTML = '';
            
            if (filteredUsers.length === 0) {
                usersTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-light);">No users found matching your search</td></tr>';
                return;
            }
            
            filteredUsers.forEach(user => {
                const row = document.createElement('tr');
                
                const fingerprintCell = document.createElement('td');
                fingerprintCell.textContent = user.fingerprint;
                
                const usageCell = document.createElement('td');
                usageCell.textContent = user.usageCount;
                
                const unlockedCell = document.createElement('td');
                const unlockedBadge = document.createElement('span');
                unlockedBadge.className = user.isUnlocked ? 'badge badge-success' : 'badge badge-error';
                unlockedBadge.textContent = user.isUnlocked ? 'Yes' : 'No';
                unlockedCell.appendChild(unlockedBadge);
                
                const lastActiveCell = document.createElement('td');
                lastActiveCell.textContent = new Date(user.lastActive).toLocaleDateString();
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'actions';
                
                const unlockBtn = document.createElement('button');
                unlockBtn.className = 'btn btn-sm ' + (user.isUnlocked ? 'btn-error' : 'btn-success');
                unlockBtn.textContent = user.isUnlocked ? 'Revoke' : 'Unlock';
                unlockBtn.addEventListener('click', function() {
                    toggleUserUnlock(user.fingerprint);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-sm btn-error';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', function() {
                    deleteUser(user.fingerprint);
                });
                
                actionsCell.appendChild(unlockBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(fingerprintCell);
                row.appendChild(usageCell);
                row.appendChild(unlockedCell);
                row.appendChild(lastActiveCell);
                row.appendChild(actionsCell);
                
                usersTableBody.appendChild(row);
            });
        }
        
        function toggleUserUnlock(fingerprint) {
            const user = adminData.users.find(u => u.fingerprint === fingerprint);
            if (user) {
                user.isUnlocked = !user.isUnlocked;
                
                // Also update the main app's storage
                updateMainAppUserUnlock(fingerprint, user.isUnlocked);
                
                // Log activity
                adminData.activityLog.push({
                    action: user.isUnlocked ? 'User unlocked manually' : 'User access revoked',
                    userFingerprint: fingerprint,
                    timestamp: Date.now()
                });
                
                saveAdminData();
                loadUsersTable();
                updateDashboard();
                
                alert(`User ${user.isUnlocked ? 'unlocked' : 'locked'} successfully!`);
            }
        }
        
        function updateMainAppUserUnlock(fingerprint, isUnlocked) {
            try {
                // Get the current unlocked users from main app
                const unlockedUsers = JSON.parse(localStorage.getItem('slipzy_secure_data_unlockedUsers') || '[]');
                
                if (isUnlocked) {
                    // Add user to unlocked list if not already there
                    if (!unlockedUsers.includes(fingerprint)) {
                        unlockedUsers.push(fingerprint);
                    }
                } else {
                    // Remove user from unlocked list
                    const index = unlockedUsers.indexOf(fingerprint);
                    if (index > -1) {
                        unlockedUsers.splice(index, 1);
                    }
                }
                
                // Save back to main app storage
                localStorage.setItem('slipzy_secure_data_unlockedUsers', JSON.stringify(unlockedUsers));
            } catch (e) {
                console.error('Error updating main app user unlock status:', e);
            }
        }
        
        function deleteUser(fingerprint) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                // Remove user from admin data
                adminData.users = adminData.users.filter(u => u.fingerprint !== fingerprint);
                
                // Also remove from main app storage
                try {
                    localStorage.removeItem(`slipzy_secure_data_usageCount_${fingerprint}`);
                    
                    // Remove from unlocked users list
                    const unlockedUsers = JSON.parse(localStorage.getItem('slipzy_secure_data_unlockedUsers') || '[]');
                    const index = unlockedUsers.indexOf(fingerprint);
                    if (index > -1) {
                        unlockedUsers.splice(index, 1);
                        localStorage.setItem('slipzy_secure_data_unlockedUsers', JSON.stringify(unlockedUsers));
                    }
                } catch (e) {
                    console.error('Error deleting user from main app storage:', e);
                }
                
                // Log activity
                adminData.activityLog.push({
                    action: 'User deleted',
                    userFingerprint: fingerprint,
                    timestamp: Date.now()
                });
                
                saveAdminData();
                loadUsersTable();
                updateDashboard();
                
                alert('User deleted successfully!');
            }
        }
        
        function loadCodesTable() {
            codesTableBody.innerHTML = '';
            
            if (adminData.unlockCodes.length === 0) {
                codesTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-light);">No unlock codes found</td></tr>';
                return;
            }
            
            adminData.unlockCodes.forEach(code => {
                const row = document.createElement('tr');
                
                const codeCell = document.createElement('td');
                codeCell.textContent = code.code;
                
                const typeCell = document.createElement('td');
                typeCell.textContent = code.type.charAt(0).toUpperCase() + code.type.slice(1);
                
                const usesCell = document.createElement('td');
                usesCell.textContent = code.uses || 0;
                
                const maxUsesCell = document.createElement('td');
                maxUsesCell.textContent = code.maxUses || 'Unlimited';
                
                const expiresCell = document.createElement('td');
                expiresCell.textContent = new Date(code.expires).toLocaleDateString();
                
                const statusCell = document.createElement('td');
                const statusBadge = document.createElement('span');
                
                const now = Date.now();
                if (now > code.expires) {
                    statusBadge.className = 'badge badge-error';
                    statusBadge.textContent = 'Expired';
                } else if (code.maxUses && code.uses >= code.maxUses) {
                    statusBadge.className = 'badge badge-warning';
                    statusBadge.textContent = 'Max Uses Reached';
                } else if (!code.active) {
                    statusBadge.className = 'badge badge-error';
                    statusBadge.textContent = 'Inactive';
                } else {
                    statusBadge.className = 'badge badge-success';
                    statusBadge.textContent = 'Active';
                }
                
                statusCell.appendChild(statusBadge);
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'actions';
                
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'btn btn-sm ' + (code.active ? 'btn-error' : 'btn-success');
                toggleBtn.textContent = code.active ? 'Deactivate' : 'Activate';
                toggleBtn.addEventListener('click', function() {
                    toggleCodeStatus(code.code);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-sm btn-error';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', function() {
                    deleteCode(code.code);
                });
                
                actionsCell.appendChild(toggleBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(codeCell);
                row.appendChild(typeCell);
                row.appendChild(usesCell);
                row.appendChild(maxUsesCell);
                row.appendChild(expiresCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                codesTableBody.appendChild(row);
            });
        }
        
        function generateUnlockCode() {
            const type = codeType.value;
            const validityDays = parseInt(codeValidity.value);
            
            // Generate a random code
            const code = 'SLIPZY-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            
            // Determine max uses based on type
            let maxUses;
            switch(type) {
                case 'single':
                    maxUses = 1;
                    break;
                case 'multi':
                    maxUses = 10;
                    break;
                case 'unlimited':
                    maxUses = null; // No limit
                    break;
            }
            
            // Create code object
            const unlockCode = {
                code: code,
                type: type,
                maxUses: maxUses,
                uses: 0,
                active: true,
                created: Date.now(),
                expires: Date.now() + (validityDays * 24 * 60 * 60 * 1000)
            };
            
            // Add to admin data
            adminData.unlockCodes.push(unlockCode);
            
            // Log activity
            adminData.activityLog.push({
                action: `Unlock code generated (${type})`,
                timestamp: Date.now()
            });
            
            saveAdminData();
            
            // Show the code in modal
            generatedCode.textContent = code;
            codeTypeDisplay.textContent = type.charAt(0).toUpperCase() + type.slice(1) + ' Use';
            codeExpiryDisplay.textContent = new Date(unlockCode.expires).toLocaleDateString();
            
            codeModal.style.display = 'flex';
            
            // Reload codes table
            loadCodesTable();
        }
        
        function toggleCodeStatus(code) {
            const unlockCode = adminData.unlockCodes.find(c => c.code === code);
            if (unlockCode) {
                unlockCode.active = !unlockCode.active;
                
                // Log activity
                adminData.activityLog.push({
                    action: `Unlock code ${unlockCode.active ? 'activated' : 'deactivated'}`,
                    timestamp: Date.now()
                });
                
                saveAdminData();
                loadCodesTable();
                
                alert(`Code ${unlockCode.active ? 'activated' : 'deactivated'} successfully!`);
            }
        }
        
        function deleteCode(code) {
            if (confirm('Are you sure you want to delete this unlock code? This action cannot be undone.')) {
                adminData.unlockCodes = adminData.unlockCodes.filter(c => c.code !== code);
                
                // Log activity
                adminData.activityLog.push({
                    action: 'Unlock code deleted',
                    timestamp: Date.now()
                });
                
                saveAdminData();
                loadCodesTable();
                
                alert('Unlock code deleted successfully!');
            }
        }
        
        function copyCodeToClipboard() {
            const codeText = generatedCode.textContent;
            
            navigator.clipboard.writeText(codeText).then(function() {
                // Change button text temporarily
                const originalText = copyCodeBtn.textContent;
                copyCodeBtn.textContent = 'Copied!';
                
                setTimeout(function() {
                    copyCodeBtn.textContent = originalText;
                }, 2000);
            }, function(err) {
                console.error('Could not copy text: ', err);
                alert('Failed to copy code to clipboard');
            });
        }
        
        function loadTransactionsTable() {
            transactionsTableBody.innerHTML = '';
            
            if (adminData.transactions.length === 0) {
                transactionsTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-light);">No transactions found</td></tr>';
                return;
            }
            
            adminData.transactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                const idCell = document.createElement('td');
                idCell.textContent = transaction.id;
                
                const userCell = document.createElement('td');
                userCell.textContent = transaction.userFingerprint ? 
                    transaction.userFingerprint.substring(0, 8) + '...' : 'Unknown';
                
                const amountCell = document.createElement('td');
                amountCell.textContent = `$${transaction.amount.toFixed(2)}`;
                
                const dateCell = document.createElement('td');
                dateCell.textContent = new Date(transaction.date).toLocaleDateString();
                
                const statusCell = document.createElement('td');
                const statusBadge = document.createElement('span');
                statusBadge.className = transaction.status === 'completed' ? 'badge badge-success' : 
                                      transaction.status === 'pending' ? 'badge badge-warning' : 'badge badge-error';
                statusBadge.textContent = transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1);
                statusCell.appendChild(statusBadge);
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'actions';
                
                if (transaction.status === 'pending') {
                    const approveBtn = document.createElement('button');
                    approveBtn.className = 'btn btn-sm btn-success';
                    approveBtn.textContent = 'Approve';
                    approveBtn.addEventListener('click', function() {
                        approveTransaction(transaction.id);
                    });
                    
                    const rejectBtn = document.createElement('button');
                    rejectBtn.className = 'btn btn-sm btn-error';
                    rejectBtn.textContent = 'Reject';
                    rejectBtn.addEventListener('click', function() {
                        rejectTransaction(transaction.id);
                    });
                    
                    actionsCell.appendChild(approveBtn);
                    actionsCell.appendChild(rejectBtn);
                } else {
                    actionsCell.textContent = '-';
                }
                
                row.appendChild(idCell);
                row.appendChild(userCell);
                row.appendChild(amountCell);
                row.appendChild(dateCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                transactionsTableBody.appendChild(row);
            });
        }
        
        function searchTransactions() {
            const searchTerm = transactionSearch.value.trim().toLowerCase();
            
            if (!searchTerm) {
                loadTransactionsTable();
                return;
            }
            
            const filteredTransactions = adminData.transactions.filter(transaction => 
                transaction.id.toLowerCase().includes(searchTerm) ||
                (transaction.userFingerprint && transaction.userFingerprint.toLowerCase().includes(searchTerm))
            );
            
            transactionsTableBody.innerHTML = '';
            
            if (filteredTransactions.length === 0) {
                transactionsTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-light);">No transactions found matching your search</td></tr>';
                return;
            }
            
            filteredTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                const idCell = document.createElement('td');
                idCell.textContent = transaction.id;
                
                const userCell = document.createElement('td');
                userCell.textContent = transaction.userFingerprint ? 
                    transaction.userFingerprint.substring(0, 8) + '...' : 'Unknown';
                
                const amountCell = document.createElement('td');
                amountCell.textContent = `$${transaction.amount.toFixed(2)}`;
                
                const dateCell = document.createElement('td');
                dateCell.textContent = new Date(transaction.date).toLocaleDateString();
                
                const statusCell = document.createElement('td');
                const statusBadge = document.createElement('span');
                statusBadge.className = transaction.status === 'completed' ? 'badge badge-success' : 
                                      transaction.status === 'pending' ? 'badge badge-warning' : 'badge badge-error';
                statusBadge.textContent = transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1);
                statusCell.appendChild(statusBadge);
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'actions';
                
                if (transaction.status === 'pending') {
                    const approveBtn = document.createElement('button');
                    approveBtn.className = 'btn btn-sm btn-success';
                    approveBtn.textContent = 'Approve';
                    approveBtn.addEventListener('click', function() {
                        approveTransaction(transaction.id);
                    });
                    
                    const rejectBtn = document.createElement('button');
                    rejectBtn.className = 'btn btn-sm btn-error';
                    rejectBtn.textContent = 'Reject';
                    rejectBtn.addEventListener('click', function() {
                        rejectTransaction(transaction.id);
                    });
                    
                    actionsCell.appendChild(approveBtn);
                    actionsCell.appendChild(rejectBtn);
                } else {
                    actionsCell.textContent = '-';
                }
                
                row.appendChild(idCell);
                row.appendChild(userCell);
                row.appendChild(amountCell);
                row.appendChild(dateCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                transactionsTableBody.appendChild(row);
            });
        }
        
        function approveTransaction(transactionId) {
            const transaction = adminData.transactions.find(t => t.id === transactionId);
            if (transaction) {
                transaction.status = 'completed';
                
                // Find the user and unlock them
                const user = adminData.users.find(u => u.fingerprint === transaction.userFingerprint);
                if (user) {
                    user.isUnlocked = true;
                    updateMainAppUserUnlock(user.fingerprint, true);
                }
                
                // Log activity
                adminData.activityLog.push({
                    action: 'Transaction approved and user unlocked',
                    userFingerprint: transaction.userFingerprint,
                    timestamp: Date.now()
                });
                
                saveAdminData();
                loadTransactionsTable();
                updateDashboard();
                
                alert('Transaction approved and user unlocked!');
            }
        }
        
        function rejectTransaction(transactionId) {
            const transaction = adminData.transactions.find(t => t.id === transactionId);
            if (transaction) {
                transaction.status = 'rejected';
                
                // Log activity
                adminData.activityLog.push({
                    action: 'Transaction rejected',
                    userFingerprint: transaction.userFingerprint,
                    timestamp: Date.now()
                });
                
                saveAdminData();
                loadTransactionsTable();
                
                alert('Transaction rejected!');
            }
        }
        
        function loadSettings() {
            freeSlipsLimit.value = adminData.settings.freeSlipsLimit;
            premiumPrice.value = adminData.settings.premiumPrice;
        }
        
        function changeAdminPassword() {
            const newPassword = adminPasswordChange.value;
            const confirmPassword = adminPasswordConfirm.value;
            
            if (!newPassword || !confirmPassword) {
                alert('Please enter both password fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }
            
            adminData.settings.adminPassword = newPassword;
            saveAdminData();
            
            adminPasswordChange.value = '';
            adminPasswordConfirm.value = '';
            
            alert('Admin password changed successfully!');
        }
        
        function saveSettings() {
            const newFreeSlipsLimit = parseInt(freeSlipsLimit.value);
            const newPremiumPrice = parseFloat(premiumPrice.value);
            
            if (isNaN(newFreeSlipsLimit) || newFreeSlipsLimit < 1 || newFreeSlipsLimit > 100) {
                alert('Please enter a valid free slips limit between 1 and 100');
                return;
            }
            
            if (isNaN(newPremiumPrice) || newPremiumPrice < 0.01 || newPremiumPrice > 100) {
                alert('Please enter a valid premium price between $0.01 and $100');
                return;
            }
            
            adminData.settings.freeSlipsLimit = newFreeSlipsLimit;
            adminData.settings.premiumPrice = newPremiumPrice;
            
            saveAdminData();
            
            alert('Settings saved successfully!');
        }
        
        function exportAllData() {
            const dataStr = JSON.stringify(adminData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `slipzy-admin-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Log activity
            adminData.activityLog.push({
                action: 'All data exported',
                timestamp: Date.now()
            });
            
            saveAdminData();
        }
        
        function resetSystem() {
            if (confirm('Are you sure you want to reset the entire system? This will delete all users, codes, transactions, and activity logs. This action cannot be undone.')) {
                if (confirm('This is your final warning. All data will be permanently deleted. Are you absolutely sure?')) {
                    // Reset admin data
                    initializeDefaultAdminData();
                    
                    // Also clear main app data
                    try {
                        const keys = Object.keys(localStorage);
                        keys.forEach(key => {
                            if (key.startsWith('slipzy_')) {
                                localStorage.removeItem(key);
                            }
                        });
                    } catch (e) {
                        console.error('Error clearing main app data:', e);
                    }
                    
                    // Log activity
                    adminData.activityLog.push({
                        action: 'System reset',
                        timestamp: Date.now()
                    });
                    
                    saveAdminData();
                    
                    alert('System has been reset successfully!');
                    
                    // Reload the page
                    location.reload();
                }
            }
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This will delete all users, codes, and transactions but keep settings. This action cannot be undone.')) {
                // Clear users, codes, and transactions but keep settings
                adminData.users = [];
                adminData.unlockCodes = [];
                adminData.transactions = [];
                adminData.activityLog = [];
                
                // Also clear main app data
                try {
                    const keys = Object.keys(localStorage);
                    keys.forEach(key => {
                        if (key.startsWith('slipzy_secure_data_')) {
                            localStorage.removeItem(key);
                        }
                    });
                } catch (e) {
                    console.error('Error clearing main app data:', e);
                }
                
                // Log activity
                adminData.activityLog.push({
                    action: 'All data cleared',
                    timestamp: Date.now()
                });
                
                saveAdminData();
                
                updateDashboard();
                loadUsersTable();
                loadCodesTable();
                loadTransactionsTable();
                
                alert('All data has been cleared successfully!');
            }
        }
    </script>
</body>
</html>
