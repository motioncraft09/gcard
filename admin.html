<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Slipzy Admin – Unlock Manager</title>
  <style>
    body{font-family:Inter,Arial;margin:24px;background:#fff;color:#111}
    .card{padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:12px}
    input,select,textarea{padding:8px;border-radius:8px;border:1px solid #ddd;width:100%;box-sizing:border-box}
    button{padding:10px 14px;border-radius:8px;border:0;background:#0b72ff;color:#fff;font-weight:700;cursor:pointer}
    .row{display:flex;gap:10px}
    .col{flex:1}
  </style>
</head>
<body>
  <h2>Slipzy Admin — Unlock Manager</h2>
  <div class="card">
    <label>Web App URL (Apps Script):</label>
    <input id="weburl" value="https://script.google.com/macros/s/AKfycbxPmCJrrt9sa3CkclgzevAiGRP2NfMMMM9_fO685VguDb2Cc6cpfqspOf2Py5MxSQZb/exec">
    <label>Admin Key:</label>
    <input id="adminkey" value="hasib123">
  </div>

  <div class="card">
    <h3>Create Unlock Code</h3>
    <label>User identifier (email or phone):</label>
    <input id="user">
    <label>User IP (dot notation) — optional:</label>
    <input id="ip" placeholder="e.g. 203.0.113.45">
    <label>TX ID / Note (optional):</label>
    <input id="note">
    <div style="margin-top:8px"><button id="createBtn">Create Unlock Code</button></div>
    <div id="createRes" style="margin-top:8px;color:green"></div>
  </div>

  <div class="card">
    <h3>Revoke Code</h3>
    <label>Code to revoke:</label>
    <input id="revokeCode">
    <div style="margin-top:8px"><button id="revokeBtn">Revoke</button></div>
    <div id="revokeRes" style="margin-top:8px;color:red"></div>
  </div>

  <div class="card">
    <h3>List Codes (admin)</h3>
    <div style="margin-top:8px"><button id="listBtn">Refresh List</button></div>
    <pre id="listArea" style="white-space:pre-wrap;max-height:300px;overflow:auto;background:#fafafa;padding:10px;border-radius:8px;border:1px solid #eee"></pre>
  </div>

<script>
async function callApi(action, data){
  const web = document.getElementById('weburl').value.trim();
  const adminkey = document.getElementById('adminkey').value.trim();
  if(!web){alert('Set web app URL'); return;}
  data = data || {};
  data.action = action;
  // ensure admin_key for create/revoke/list
  if(action==='create' || action==='revoke' || action==='list'){
    data.admin_key = adminkey;
  }
  const resp = await fetch(web, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(data)
  });
  return resp.json();
}

document.getElementById('createBtn').onclick = async ()=>{
  const user = document.getElementById('user').value.trim();
  const ip = document.getElementById('ip').value.trim();
  const note = document.getElementById('note').value.trim();
  const res = await callApi('create',{user_identifier:user, ip:ip, note:note, admin:'admin'});
  document.getElementById('createRes').innerText = JSON.stringify(res);
}

document.getElementById('revokeBtn').onclick = async ()=>{
  const code = document.getElementById('revokeCode').value.trim();
  if(!code){alert('Enter code'); return;}
  const res = await callApi('revoke',{code:code});
  document.getElementById('revokeRes').innerText = JSON.stringify(res);
}

document.getElementById('listBtn').onclick = async ()=>{
  const res = await callApi('list', {});
  document.getElementById('listArea').innerText = JSON.stringify(res, null, 2);
}
</script>
</body>
</html>
