<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneXX - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #06b6d4;
            --light-bg: #f9fafb;
            --card-bg: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-light: #e5e7eb;
            --success: #10b981;
            --danger: #ef4444;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--light-bg);
            color: var(--text-dark);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .card-white {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-light);
        }
        
        .input-field {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: var(--text-dark);
            transition: all 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        .nav-active {
            background-color: rgb(224 231 255);
            color: rgb(79 70 229);
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .admin-table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .admin-table tr:hover {
            background-color: #f9fafb;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-active {
            background-color: #dcfce7;
            color: #16a34a;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }
        
        .status-expired {
            background-color: #fee2e2;
            color: #dc2626;
        }
        
        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            font-size: 14px;
        }
        
        .edit-btn {
            background: #e0e7ff;
            color: var(--primary);
        }
        
        .delete-btn {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            background: var(--success);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .page-section {
            display: none;
        }
        
        .active-section {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex items-center text-indigo-600 font-bold text-xl cursor-pointer" id="logo">
                        <span class="mr-2"><i class="fas fa-shield-alt"></i></span> OneXX Admin
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="nav-dashboard" class="px-3 py-2 rounded-md text-sm font-medium nav-active">
                        Dashboard
                    </button>
                    <button id="nav-guarantees" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-gray-100">
                        Guarantees
                    </button>
                    <button id="nav-settings" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-gray-100">
                        Settings
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-16">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="page-section active-section">
            <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Admin Dashboard</h1>
                
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-indigo-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-file-contract text-indigo-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Total Guarantees</h2>
                                <p class="text-3xl font-bold text-gray-900" id="total-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-green-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Active Guarantees</h2>
                                <p class="text-3xl font-bold text-gray-900" id="active-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-yellow-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-clock text-yellow-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Pending Verification</h2>
                                <p class="text-3xl font-bold text-gray-900" id="pending-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-md border-l-4 border-red-500">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-times-circle text-red-600 text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-lg font-semibold text-gray-900">Expired Guarantees</h2>
                                <p class="text-3xl font-bold text-gray-900" id="expired-guarantees">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-xl font-bold text-gray-900">Recent Guarantees</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Certificate ID</th>
                                    <th>Seller</th>
                                    <th>Buyer</th>
                                    <th>Value</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recent-guarantees">
                                <!-- Guarantees will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Guarantees Section -->
        <section id="guarantees-section" class="page-section">
            <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Manage Guarantees</h1>
                
                <!-- Filters and Search -->
                <div class="bg-white p-6 rounded-2xl shadow-md mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                            <input type="text" id="search-guarantees" class="w-full px-4 py-2 input-field rounded-md" placeholder="Certificate ID, Name...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="filter-status" class="w-full px-4 py-2 input-field rounded-md">
                                <option value="">All Statuses</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="expired">Expired</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date From</label>
                            <input type="date" id="filter-date-from" class="w-full px-4 py-2 input-field rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date To</label>
                            <input type="date" id="filter-date-to" class="w-full px-4 py-2 input-field rounded-md">
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button id="reset-filters" class="bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-md hover:bg-gray-300 transition-all duration-300 mr-2">
                            Reset
                        </button>
                        <button id="apply-filters" class="gradient-bg text-white font-medium py-2 px-4 rounded-md hover:shadow-lg transition-all duration-300">
                            Apply Filters
                        </button>
                    </div>
                </div>
                
                <!-- Guarantees Table -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-900">All Guarantees</h2>
                        <button id="refresh-guarantees" class="bg-indigo-600 text-white font-medium py-2 px-4 rounded-md hover:bg-indigo-700 transition-all duration-300">
                            <i class="fas fa-sync-alt mr-2"></i> Refresh Data
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Certificate ID</th>
                                    <th>Seller</th>
                                    <th>Buyer</th>
                                    <th>Value</th>
                                    <th>Created</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="all-guarantees">
                                <!-- Guarantees will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Settings Section -->
        <section id="settings-section" class="page-section">
            <div class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">System Settings</h1>
                
                <!-- Fee Structure -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Fee Structure</h2>
                        <p class="text-indigo-100 mt-1">Configure the guarantee fee calculation rules</p>
                    </div>
                    <div class="px-6 py-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Tier 1 (≤$40) Fee Percentage
                            </label>
                            <div class="flex items-center">
                                <input type="number" id="tier1-fee" min="0" max="100" class="w-32 px-4 py-2 input-field rounded-md">
                                <span class="ml-2 text-gray-700">%</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Tier 2 ($40.01-$160) Fee Percentage
                            </label>
                            <div class="flex items-center">
                                <input type="number" id="tier2-fee" min="0" max="100" class="w-32 px-4 py-2 input-field rounded-md">
                                <span class="ml-2 text-gray-700">%</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Tier 3 (≥$160.01) Fee Percentage
                            </label>
                            <div class="flex items-center">
                                <input type="number" id="tier3-fee" min="0" max="100" class="w-32 px-4 py-2 input-field rounded-md">
                                <span class="ml-2 text-gray-700">%</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Minimum Fee for Tier 3
                            </label>
                            <div class="flex items-center">
                                <span class="mr-2 text-gray-700">$</span>
                                <input type="number" id="min-tier3-fee" min="0" step="0.01" class="w-32 px-4 py-2 input-field rounded-md">
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="save-fees" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Fee Structure
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Methods -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Payment Methods</h2>
                        <p class="text-indigo-100 mt-1">Update payment method details</p>
                    </div>
                    <div class="px-6 py-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    bKash Number
                                </label>
                                <input type="text" id="bkash-number" class="w-full px-4 py-2 input-field rounded-md">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Nagad Number
                                </label>
                                <input type="text" id="nagad-number" class="w-full px-4 py-2 input-field rounded-md">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Rocket Number
                                </label>
                                <input type="text" id="rocket-number" class="w-full px-4 py-2 input-field rounded-md">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    PayPal Email
                                </label>
                                <input type="email" id="paypal-email" class="w-full px-4 py-2 input-field rounded-md">
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="save-payments" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Payment Methods
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sample Certificate -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="gradient-bg px-6 py-4">
                        <h2 class="text-2xl font-bold text-white">Sample Certificate</h2>
                        <p class="text-indigo-100 mt-1">Customize the sample certificate on the homepage</p>
                    </div>
                    <div class="px-6 py-6">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Seller Name
                            </label>
                            <input type="text" id="sample-seller" class="w-full px-4 py-2 input-field rounded-md">
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Buyer Name
                            </label>
                            <input type="text" id="sample-buyer" class="w-full px-4 py-2 input-field rounded-md">
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Service Value
                            </label>
                            <input type="text" id="sample-value" class="w-full px-4 py-2 input-field rounded-md">
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Certificate ID
                            </label>
                            <input type="text" id="sample-certificate" class="w-full px-4 py-2 input-field rounded-md">
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="save-certificate" class="gradient-bg text-white font-medium py-2 px-6 rounded-md hover:shadow-lg transition-all duration-300">
                                Save Certificate Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        Settings saved successfully!
    </div>

    <script>
        // Data storage keys - must match main website
        const STORAGE_KEYS = {
            GUARANTEES: 'onexx_guarantees',
            FEES: 'onexx_fee_structure',
            PAYMENTS: 'onexx_payment_methods',
            CERTIFICATE: 'onexx_sample_certificate'
        };

        // Initialize data
        function initializeData() {
            // Initialize guarantees if not exists
            if (!localStorage.getItem(STORAGE_KEYS.GUARANTEES)) {
                localStorage.setItem(STORAGE_KEYS.GUARANTEES, JSON.stringify([]));
            }

            // Initialize fee structure if not exists
            if (!localStorage.getItem(STORAGE_KEYS.FEES)) {
                const feeStructure = {
                    tier1: 5,
                    tier2: 3,
                    tier3: 2,
                    minTier3: 8
                };
                localStorage.setItem(STORAGE_KEYS.FEES, JSON.stringify(feeStructure));
            }

            // Initialize payment methods if not exists
            if (!localStorage.getItem(STORAGE_KEYS.PAYMENTS)) {
                const paymentMethods = {
                    bkash: '01322149482',
                    nagad: '01322149482',
                    rocket: '01322149482',
                    paypal: 'payments@onexx.com'
                };
                localStorage.setItem(STORAGE_KEYS.PAYMENTS, JSON.stringify(paymentMethods));
            }

            // Initialize sample certificate if not exists
            if (!localStorage.getItem(STORAGE_KEYS.CERTIFICATE)) {
                const sampleCertificate = {
                    seller: 'John\'s Service',
                    buyer: 'Jane Client',
                    value: '$1,500',
                    certificateId: 'OXX-123456-ABC789'
                };
                localStorage.setItem(STORAGE_KEYS.CERTIFICATE, JSON.stringify(sampleCertificate));
            }
        }

        // Load data from localStorage
        function loadData() {
            // Load guarantees
            const guarantees = JSON.parse(localStorage.getItem(STORAGE_KEYS.GUARANTEES) || '[]');
            
            // Update stats
            document.getElementById('total-guarantees').textContent = guarantees.length;
            document.getElementById('active-guarantees').textContent = guarantees.filter(g => g.status === 'active').length;
            document.getElementById('pending-guarantees').textContent = guarantees.filter(g => g.status === 'pending').length;
            document.getElementById('expired-guarantees').textContent = guarantees.filter(g => g.status === 'expired').length;
            
            // Render recent guarantees (last 5)
            const recentGuarantees = guarantees.slice(-5).reverse();
            renderGuarantees(recentGuarantees, 'recent-guarantees');
            
            // Render all guarantees
            renderGuarantees(guarantees, 'all-guarantees');
            
            // Load fee structure
            const fees = JSON.parse(localStorage.getItem(STORAGE_KEYS.FEES) || '{}');
            document.getElementById('tier1-fee').value = fees.tier1 || 5;
            document.getElementById('tier2-fee').value = fees.tier2 || 3;
            document.getElementById('tier3-fee').value = fees.tier3 || 2;
            document.getElementById('min-tier3-fee').value = fees.minTier3 || 8;
            
            // Load payment methods
            const payments = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAYMENTS) || '{}');
            document.getElementById('bkash-number').value = payments.bkash || '01322149482';
            document.getElementById('nagad-number').value = payments.nagad || '01322149482';
            document.getElementById('rocket-number').value = payments.rocket || '01322149482';
            document.getElementById('paypal-email').value = payments.paypal || 'payments@onexx.com';
            
            // Load sample certificate
            const certificate = JSON.parse(localStorage.getItem(STORAGE_KEYS.CERTIFICATE) || '{}');
            document.getElementById('sample-seller').value = certificate.seller || 'John\'s Service';
            document.getElementById('sample-buyer').value = certificate.buyer || 'Jane Client';
            document.getElementById('sample-value').value = certificate.value || '$1,500';
            document.getElementById('sample-certificate').value = certificate.certificateId || 'OXX-123456-ABC789';
        }

        // Render guarantees to a table
        function renderGuarantees(guarantees, elementId) {
            const tbody = document.getElementById(elementId);
            tbody.innerHTML = '';
            
            if (guarantees.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-gray-500">No guarantees found</td></tr>`;
                return;
            }
            
            guarantees.forEach(guarantee => {
                const row = document.createElement('tr');
                
                // Determine status class
                let statusClass = 'status-pending';
                if (guarantee.status === 'active') statusClass = 'status-active';
                if (guarantee.status === 'expired') statusClass = 'status-expired';
                
                row.innerHTML = `
                    <td class="font-mono">${guarantee.certificateId}</td>
                    <td>${guarantee.seller}</td>
                    <td>${guarantee.buyer}</td>
                    <td>${guarantee.value}</td>
                    ${elementId === 'all-guarantees' ? `<td>${guarantee.created}</td>` : ''}
                    <td><span class="status-badge ${statusClass}">${guarantee.status.charAt(0).toUpperCase() + guarantee.status.slice(1)}</span></td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${guarantee.id}">Edit</button>
                        <button class="action-btn delete-btn" data-id="${guarantee.id}">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Save fee structure
        function saveFeeStructure() {
            const feeStructure = {
                tier1: parseInt(document.getElementById('tier1-fee').value),
                tier2: parseInt(document.getElementById('tier2-fee').value),
                tier3: parseInt(document.getElementById('tier3-fee').value),
                minTier3: parseFloat(document.getElementById('min-tier3-fee').value)
            };
            
            localStorage.setItem(STORAGE_KEYS.FEES, JSON.stringify(feeStructure));
            showNotification('Fee structure saved successfully!');
        }

        // Save payment methods
        function savePaymentMethods() {
            const paymentMethods = {
                bkash: document.getElementById('bkash-number').value,
                nagad: document.getElementById('nagad-number').value,
                rocket: document.getElementById('rocket-number').value,
                paypal: document.getElementById('paypal-email').value
            };
            
            localStorage.setItem(STORAGE_KEYS.PAYMENTS, JSON.stringify(paymentMethods));
            showNotification('Payment methods saved successfully!');
        }

        // Save sample certificate
        function saveSampleCertificate() {
            const certificate = {
                seller: document.getElementById('sample-seller').value,
                buyer: document.getElementById('sample-buyer').value,
                value: document.getElementById('sample-value').value,
                certificateId: document.getElementById('sample-certificate').value
            };
            
            localStorage.setItem(STORAGE_KEYS.CERTIFICATE, JSON.stringify(certificate));
            showNotification('Certificate settings saved successfully!');
        }

        // Filter guarantees
        function filterGuarantees() {
            const searchTerm = document.getElementById('search-guarantees').value.toLowerCase();
            const statusFilter = document.getElementById('filter-status').value;
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            
            const guarantees = JSON.parse(localStorage.getItem(STORAGE_KEYS.GUARANTEES) || '[]');
            
            let filteredGuarantees = guarantees;
            
            // Apply search filter
            if (searchTerm) {
                filteredGuarantees = filteredGuarantees.filter(g => 
                    g.certificateId.toLowerCase().includes(searchTerm) ||
                    g.seller.toLowerCase().includes(searchTerm) ||
                    g.buyer.toLowerCase().includes(searchTerm) ||
                    g.value.toLowerCase().includes(searchTerm)
                );
            }
            
            // Apply status filter
            if (statusFilter) {
                filteredGuarantees = filteredGuarantees.filter(g => g.status === statusFilter);
            }
            
            // Apply date filters
            if (dateFrom) {
                filteredGuarantees = filteredGuarantees.filter(g => g.created >= dateFrom);
            }
            
            if (dateTo) {
                filteredGuarantees = filteredGuarantees.filter(g => g.created <= dateTo);
            }
            
            renderGuarantees(filteredGuarantees, 'all-guarantees');
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('search-guarantees').value = '';
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-date-from').value = '';
            document.getElementById('filter-date-to').value = '';
            
            const guarantees = JSON.parse(localStorage.getItem(STORAGE_KEYS.GUARANTEES) || '[]');
            renderGuarantees(guarantees, 'all-guarantees');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data
            initializeData();
            loadData();
            
            // Set up navigation
            const navDashboard = document.getElementById('nav-dashboard');
            const navGuarantees = document.getElementById('nav-guarantees');
            const navSettings = document.getElementById('nav-settings');
            
            const dashboardSection = document.getElementById('dashboard-section');
            const guaranteesSection = document.getElementById('guarantees-section');
            const settingsSection = document.getElementById('settings-section');
            
            // Function to change active section
            function changeActiveSection(section) {
                // Hide all sections
                dashboardSection.classList.remove('active-section');
                guaranteesSection.classList.remove('active-section');
                settingsSection.classList.remove('active-section');
                
                // Remove active class from all nav buttons
                navDashboard.classList.remove('nav-active');
                navGuarantees.classList.remove('nav-active');
                navSettings.classList.remove('nav-active');
                
                // Show the selected section
                section.classList.add('active-section');
                
                // Add active class to the corresponding nav button
                if (section === dashboardSection) {
                    navDashboard.classList.add('nav-active');
                } else if (section === guaranteesSection) {
                    navGuarantees.classList.add('nav-active');
                } else if (section === settingsSection) {
                    navSettings.classList.add('nav-active');
                }
            }
            
            // Add event listeners to navigation buttons
            navDashboard.addEventListener('click', function() {
                changeActiveSection(dashboardSection);
            });
            
            navGuarantees.addEventListener('click', function() {
                changeActiveSection(guaranteesSection);
            });
            
            navSettings.addEventListener('click', function() {
                changeActiveSection(settingsSection);
            });
            
            // Save buttons functionality
            document.getElementById('save-fees').addEventListener('click', saveFeeStructure);
            document.getElementById('save-payments').addEventListener('click', savePaymentMethods);
            document.getElementById('save-certificate').addEventListener('click', saveSampleCertificate);
            
            // Filter functionality
            document.getElementById('apply-filters').addEventListener('click', filterGuarantees);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);
            document.getElementById('search-guarantees').addEventListener('input', filterGuarantees);
            document.getElementById('filter-status').addEventListener('change', filterGuarantees);
            document.getElementById('filter-date-from').addEventListener('change', filterGuarantees);
            document.getElementById('filter-date-to').addEventListener('change', filterGuarantees);
            
            // Refresh data button
            document.getElementById('refresh-guarantees').addEventListener('click', function() {
                loadData();
                showNotification('Data refreshed successfully!');
            });
        });
    </script>
</body>
</html>
