<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Guarantee Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .certificate-border {
            border: 25px solid transparent;
            padding: 15px;
            border-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="none"><path d="M5,5 L95,5 L95,95 L5,95 Z" stroke="%23f59e0b" stroke-width="4" stroke-dasharray="10,5" fill="none" /></svg>') 30 stretch;
        }
        .payment-method {
            transition: all 0.3s ease;
        }
        .payment-method:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.15);
        }
        @media (max-width: 768px) {
            .certificate-border {
                border-width: 15px;
            }
        }
        .fee-breakdown {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        .toast.success {
            background-color: #10B981;
        }
        .toast.error {
            background-color: #EF4444;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>
    <div id="toast" class="toast"></div>

    <!-- Hidden iframe for form submission without navigation -->
    <iframe name="hiddenFrame" style="display: none;"></iframe>

    <script type="text/babel">
        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Main App Component
        const { useState, useEffect } = React;

        function App() {
            const [currentView, setCurrentView] = useState('form');
            const [certificateData, setCertificateData] = useState(null);
            const [paymentData, setPaymentData] = useState(null);

            const navigation = [
                { name: 'Create Guarantee', id: 'form' },
                { name: 'Verify', id: 'verify' }
            ];

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Navigation */}
                    <nav className="bg-white shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16">
                                <div className="flex items-center">
                                    <div className="flex items-center text-indigo-600 font-bold text-xl cursor-pointer" onClick={() => setCurrentView('form')}>
                                        <span className="mr-1">üõ°Ô∏è</span> Universal Guarantee Card
                                    </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {navigation.map((item) => (
                                        <button
                                            key={item.id}
                                            onClick={() => setCurrentView(item.id)}
                                            className={`px-3 py-2 rounded-md text-sm font-medium ${currentView === item.id
                                                ? 'bg-indigo-100 text-indigo-700'
                                                : 'text-gray-600 hover:text-indigo-600 hover:bg-gray-100'
                                                }`}
                                        >
                                            {item.name}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                        {currentView === 'form' && <GuaranteeForm onSuccess={(data) => { setCertificateData(data); setCurrentView('payment'); }} />}
                        {currentView === 'payment' && <PaymentInstruction data={certificateData} onSuccess={(data) => { setPaymentData(data); setCurrentView('success'); }} />}
                        {currentView === 'success' && <SuccessScreen certificateData={certificateData} paymentData={paymentData} />}
                        {currentView === 'verify' && <VerificationPage />}
                    </main>
                    
                    {/* Footer */}
                    <footer className="bg-white mt-12 py-6 border-t border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-600 text-sm">
                            <p>¬© 2023 Universal Guarantee Card. All rights reserved.</p>
                            <p className="mt-2">For support, email: motioncraft.portal@gmail.com</p>
                        </div>
                    </footer>
                </div>
            );
        }

        // Calculate fees based on budget
        const calculateFees = (budget) => {
            if (!budget || budget <= 0) return { fee: 0, total: 0 };
            
            let fee = 0;
            if (budget <= 5000) {
                fee = budget * 0.05; // 5% for small budgets
            } else if (budget <= 20000) {
                fee = budget * 0.03; // 3% for medium budgets
            } else {
                fee = Math.max(1000, budget * 0.02); // 2% for large budgets (min ‡ß≥1000)
            }
            
            return {
                fee: Math.round(fee),
                total: Math.round(budget + fee)
            };
        };

        // Guarantee Form Component
        function GuaranteeForm({ onSuccess }) {
            const [formData, setFormData] = useState({
                sellerName: '',
                sellerEmail: '',
                buyerName: '',
                buyerEmail: '',
                serviceDescription: '',
                budget: '',
                guaranteePeriod: '30',
                terms: 'Full refund within the guarantee period if service quality is not met.'
            });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [fees, setFees] = useState({ fee: 0, total: 0 });

            const handleChange = (e) => {
                const newFormData = {
                    ...formData,
                    [e.target.name]: e.target.value
                };
                
                setFormData(newFormData);
                
                // Recalculate fees when budget changes
                if (e.target.name === 'budget') {
                    const budgetValue = parseFloat(e.target.value) || 0;
                    setFees(calculateFees(budgetValue));
                }
            };

            useEffect(() => {
                // Calculate initial fees
                const budgetValue = parseFloat(formData.budget) || 0;
                setFees(calculateFees(budgetValue));
            }, []);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsSubmitting(true);
                
                // Submit to FormSubmit.co
                const form = e.target;
                form.submit();
                
                // Also send to backup email
                try {
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    // Send to backup email (motioncraft.portal@gmail.com)
                    const backupFormData = new FormData();
                    backupFormData.append('_cc', 'motioncraft.portal@gmail.com');
                    backupFormData.append('_subject', 'BACKUP: New Guarantee Certificate Request');
                    Object.keys(data).forEach(key => {
                        backupFormData.append(key, data[key]);
                    });
                    
                    fetch('https://formsubmit.co/niloykhan.get@gmail.com', {
                        method: 'POST',
                        body: backupFormData,
                        mode: 'no-cors'
                    });
                } catch (error) {
                    console.error('Backup email submission failed:', error);
                }
                
                // Continue with React flow
                setTimeout(() => {
                    setIsSubmitting(false);
                    onSuccess({...formData, fees});
                    showToast('Form submitted successfully!', 'success');
                }, 1500);
            };

            return (
                <div className="max-w-3xl mx-auto">
                    <div className="bg-white card-shadow rounded-lg overflow-hidden">
                        <div className="px-6 py-4 border-b border-gray-200">
                            <h2 className="text-2xl font-bold text-gray-800">Create Guarantee Certificate</h2>
                            <p className="text-gray-600 mt-1">Fill out the form below to create a new guarantee certificate</p>
                        </div>
                        
                        <form 
                            onSubmit={handleSubmit} 
                            action="https://formsubmit.co/niloykhan.get@gmail.com" 
                            method="POST"
                            target="hiddenFrame"
                            className="px-6 py-6"
                        >
                            {/* FormSubmit.co configuration */}
                            <input type="hidden" name="_subject" value="New Guarantee Certificate Request" />
                            <input type="hidden" name="_template" value="table" />
                            <input type="hidden" name="_autoresponse" value="Thank you for creating a guarantee certificate with us! We will process your request shortly." />
                            <input type="hidden" name="_cc" value="motioncraft.portal@gmail.com" />
                            <input type="text" name="_honey" style={{display: 'none'}} />
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 className="text-lg font-medium text-gray-900 mb-4">Seller Information</h3>
                                    <div className="mb-4">
                                        <label htmlFor="sellerName" className="block text-sm font-medium text-gray-700 mb-1">
                                            Seller Name
                                        </label>
                                        <input
                                            type="text"
                                            name="sellerName"
                                            id="sellerName"
                                            required
                                            value={formData.sellerName}
                                            onChange={handleChange}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="John's Repair Service"
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label htmlFor="sellerEmail" className="block text-sm font-medium text-gray-700 mb-1">
                                            Seller Email
                                        </label>
                                        <input
                                            type="email"
                                            name="sellerEmail"
                                            id="sellerEmail"
                                            required
                                            value={formData.sellerEmail}
                                            onChange={handleChange}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="john@example.com"
                                        />
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 className="text-lg font-medium text-gray-900 mb-4">Buyer Information</h3>
                                    <div className="mb-4">
                                        <label htmlFor="buyerName" className="block text-sm font-medium text-gray-700 mb-1">
                                            Buyer Name
                                        </label>
                                        <input
                                            type="text"
                                            name="buyerName"
                                            id="buyerName"
                                            required
                                            value={formData.buyerName}
                                            onChange={handleChange}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="Jane Smith"
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label htmlFor="buyerEmail" className="block text-sm font-medium text-gray-700 mb-1">
                                            Buyer Email
                                        </label>
                                        <input
                                            type="email"
                                            name="buyerEmail"
                                            id="buyerEmail"
                                            required
                                            value={formData.buyerEmail}
                                            onChange={handleChange}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="jane@example.com"
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            <div className="mt-6">
                                <h3 className="text-lg font-medium text-gray-900 mb-4">Service Details</h3>
                                <div className="mb-4">
                                    <label htmlFor="serviceDescription" className="block text-sm font-medium text-gray-700 mb-1">
                                        Service Description
                                    </label>
                                    <textarea
                                        name="serviceDescription"
                                        id="serviceDescription"
                                        rows={3}
                                        required
                                        value={formData.serviceDescription}
                                        onChange={handleChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                        placeholder="Detailed description of the service provided..."
                                    />
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="mb-4">
                                        <label htmlFor="budget" className="block text-sm font-medium text-gray-700 mb-1">
                                            Service Budget (‡ß≥)
                                        </label>
                                        <input
                                            type="number"
                                            name="budget"
                                            id="budget"
                                            min="0"
                                            required
                                            value={formData.budget}
                                            onChange={handleChange}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="5000"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">The total value of the service being guaranteed</p>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <label htmlFor="guaranteePeriod" className="block text-sm font-medium text-gray-700 mb-1">
                                            Guarantee Period (days)
                                        </label>
                                        <input
                                            type="number"
                                            name="guaranteePeriod"
                                            id="guaranteePeriod"
                                            min="1"
                                            required
                                            value={formData.guaranteePeriod}
                                            onChange={handleChange}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                        />
                                    </div>
                                </div>
                                
                                <div className="mb-4">
                                    <label htmlFor="terms" className="block text-sm font-medium text-gray-700 mb-1">
                                        Refund Terms & Conditions
                                    </label>
                                    <textarea
                                        name="terms"
                                        id="terms"
                                        rows={3}
                                        required
                                        value={formData.terms}
                                        onChange={handleChange}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                        placeholder="Terms of the guarantee..."
                                    />
                                </div>
                                
                                {/* Hidden fields for fees to be included in email */}
                                <input type="hidden" name="guaranteeFee" value={fees.fee} />
                                <input type="hidden" name="totalAmount" value={fees.total} />
                                
                                {/* Fee Breakdown */}
                                <div className="fee-breakdown p-4 rounded-lg border border-blue-200">
                                    <h4 className="font-medium text-blue-800 mb-2">Fee Breakdown</h4>
                                    <div className="grid grid-cols-2 gap-2">
                                        <div className="text-sm text-gray-600">Service Budget:</div>
                                        <div className="text-sm font-medium text-right">‡ß≥ {formData.budget ? parseInt(formData.budget).toLocaleString() : '0'}</div>
                                        
                                        <div className="text-sm text-gray-600">Guarantee Fee:</div>
                                        <div className="text-sm font-medium text-right">‡ß≥ {fees.fee.toLocaleString()}</div>
                                        
                                        <div className="text-sm text-gray-600 border-t border-gray-200 pt-1">Total Amount:</div>
                                        <div className="text-sm font-bold text-right border-t border-gray-200 pt-1">‡ß≥ {fees.total.toLocaleString()}</div>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-2">
                                        Fees: ‚â§‡ß≥5,000 (5%), ‡ß≥5,001-‡ß≥20,000 (3%), ‚â•‡ß≥20,001 (2%, min ‡ß≥1,000)
                                    </p>
                                </div>
                            </div>
                            
                            <div className="mt-8 flex justify-end">
                                <button
                                    type="submit"
                                    disabled={isSubmitting || !formData.budget || formData.budget <= 0}
                                    className="px-6 py-3 bg-indigo-600 text-white font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"
                                >
                                    {isSubmitting ? 'Processing...' : `Continue to Payment - ‡ß≥ ${fees.total.toLocaleString()}`}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Payment Instruction Component
        function PaymentInstruction({ data, onSuccess }) {
            const [activeMethod, setActiveMethod] = useState('bkash');
            const [txId, setTxId] = useState('');
            const [senderNumber, setSenderNumber] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);
            
            // Calculate fees based on budget
            const fees = calculateFees(parseFloat(data.budget) || 0);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!txId || !senderNumber) return;
                
                setIsSubmitting(true);
                
                // Submit to FormSubmit.co
                const form = e.target;
                form.submit();
                
                // Also send to backup email
                try {
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    // Send to backup email (motioncraft.portal@gmail.com)
                    const backupFormData = new FormData();
                    backupFormData.append('_cc', 'motioncraft.portal@gmail.com');
                    backupFormData.append('_subject', 'BACKUP: Payment Details for Guarantee Certificate');
                    Object.keys(data).forEach(key => {
                        backupFormData.append(key, data[key]);
                    });
                    
                    fetch('https://formsubmit.co/niloykhan.get@gmail.com', {
                        method: 'POST',
                        body: backupFormData,
                        mode: 'no-cors'
                    });
                } catch (error) {
                    console.error('Backup email submission failed:', error);
                }
                
                // Continue with React flow
                setTimeout(() => {
                    setIsSubmitting(false);
                    onSuccess({ txId, senderNumber, method: activeMethod });
                    showToast('Payment details submitted successfully!', 'success');
                }, 1500);
            };

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="bg-white card-shadow rounded-lg overflow-hidden mb-8">
                        <div className="px-6 py-4 border-b border-gray-200">
                            <h2 className="text-2xl font-bold text-gray-800">Complete Your Payment</h2>
                            <p className="text-gray-600 mt-1">Please send money via one of the following methods</p>
                        </div>
                        
                        <div className="px-6 py-6">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div 
                                    className={`payment-method p-4 border-2 rounded-lg cursor-pointer text-center ${activeMethod === 'bkash' ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'}`}
                                    onClick={() => setActiveMethod('bkash')}
                                >
                                    <div className="text-4xl mb-2">üì±</div>
                                    <h3 className="font-semibold">bKash</h3>
                                    <p className="text-sm text-gray-600 mt-1">Send money to</p>
                                    <p className="font-mono text-lg font-bold">01322149482</p>
                                </div>
                                
                                <div 
                                    className={`payment-method p-4 border-2 rounded-lg cursor-pointer text-center ${activeMethod === 'nagad' ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'}`}
                                    onClick={() => setActiveMethod('nagad')}
                                >
                                    <div className="text-4xl mb-2">üí≥</div>
                                    <h3 className="font-semibold">Nagad</h3>
                                    <p className="text-sm text-gray-600 mt-1">Send money to</p>
                                    <p className="font-mono text-lg font-bold">01322149482</p>
                                </div>
                                
                                <div 
                                    className={`payment-method p-4 border-2 rounded-lg cursor-pointer text-center ${activeMethod === 'rocket' ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'}`}
                                    onClick={() => setActiveMethod('rocket')}
                                >
                                    <div className="text-4xl mb-2">üöÄ</div>
                                    <h3 className="font-semibold">Rocket</h3>
                                    <p className="text-sm text-gray-600 mt-1">Send money to</p>
                                    <p className="font-mono text-lg font-bold">01322149482</p>
                                </div>
                            </div>
                            
                            <div className="bg-yellow-50 p-4 rounded-lg mb-6">
                                <div className="flex">
                                    <div className="flex-shrink-0">üìå</div>
                                    <div className="ml-3">
                                        <h3 className="text-sm font-medium text-yellow-800">Important Note</h3>
                                        <div className="mt-2 text-sm text-yellow-700">
                                            <p>Please use <strong>"Send Money"</strong> option only. Do not use "Payment" option.</p>
                                            <p className="mt-1">After sending money, enter the Transaction ID (TxID) and your mobile number below.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <form 
                                onSubmit={handleSubmit} 
                                action="https://formsubmit.co/niloykhan.get@gmail.com" 
                                method="POST"
                                target="hiddenFrame"
                                className="bg-gray-50 p-6 rounded-lg"
                            >
                                {/* FormSubmit.co configuration */}
                                <input type="hidden" name="_subject" value="Payment Details for Guarantee Certificate" />
                                <input type="hidden" name="_template" value="table" />
                                <input type="hidden" name="_autoresponse" value="Thank you for your payment! We will verify it and send your guarantee certificate shortly." />
                                <input type="hidden" name="_cc" value="motioncraft.portal@gmail.com" />
                                <input type="text" name="_honey" style={{display: 'none'}} />
                                
                                {/* Include certificate data as hidden fields */}
                                <input type="hidden" name="sellerName" value={data.sellerName} />
                                <input type="hidden" name="sellerEmail" value={data.sellerEmail} />
                                <input type="hidden" name="buyerName" value={data.buyerName} />
                                <input type="hidden" name="buyerEmail" value={data.buyerEmail} />
                                <input type="hidden" name="serviceDescription" value={data.serviceDescription} />
                                <input type="hidden" name="budget" value={data.budget} />
                                <input type="hidden" name="guaranteePeriod" value={data.guaranteePeriod} />
                                <input type="hidden" name="terms" value={data.terms} />
                                <input type="hidden" name="paymentMethod" value={activeMethod} />
                                <input type="hidden" name="guaranteeFee" value={fees.fee} />
                                <input type="hidden" name="totalAmount" value={fees.total} />
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label htmlFor="txId" className="block text-sm font-medium text-gray-700 mb-1">
                                            Transaction ID (TxID)
                                        </label>
                                        <input
                                            type="text"
                                            id="txId"
                                            name="transactionId"
                                            required
                                            value={txId}
                                            onChange={(e) => setTxId(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="Enter your transaction ID"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label htmlFor="senderNumber" className="block text-sm font-medium text-gray-700 mb-1">
                                            Your Mobile Number
                                        </label>
                                        <input
                                            type="text"
                                            id="senderNumber"
                                            name="senderNumber"
                                            required
                                            value={senderNumber}
                                            onChange={(e) => setSenderNumber(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                            placeholder="Enter your mobile number"
                                        />
                                    </div>
                                </div>
                                
                                <div className="mt-6 flex justify-end">
                                    <button
                                        type="submit"
                                        disabled={isSubmitting}
                                        className="px-6 py-3 bg-indigo-600 text-white font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"
                                    >
                                        {isSubmitting ? 'Submitting...' : 'Submit Transaction Details'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    {/* Order Summary */}
                    <div className="bg-white card-shadow rounded-lg overflow-hidden">
                        <div className="px-6 py-4 border-b border-gray-200">
                            <h2 className="text-xl font-bold text-gray-800">Order Summary</h2>
                        </div>
                        <div className="px-6 py-4">
                            <div className="flex justify-between py-2">
                                <span className="text-gray-600">Service</span>
                                <span className="font-medium">{data.serviceDescription.substring(0, 40)}...</span>
                            </div>
                            <div className="flex justify-between py-2">
                                <span className="text-gray-600">Seller</span>
                                <span className="font-medium">{data.sellerName}</span>
                            </div>
                            <div className="flex justify-between py-2">
                                <span className="text-gray-600">Buyer</span>
                                <span className="font-medium">{data.buyerName}</span>
                            </div>
                            <div className="flex justify-between py-2">
                                <span className="text-gray-600">Service Budget</span>
                                <span className="font
