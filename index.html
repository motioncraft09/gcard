<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slipzy ‚Ä¢ Premium Packaging Slips</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* CSS will be dynamically injected for protection */
    </style>
</head>
<body>
    <!-- Payment Popup -->
    <div class="popup-overlay" id="payment-popup">
        <div class="popup-content">
            <button class="popup-close" id="close-popup">√ó</button>
            <h2 class="popup-title">Upgrade to Premium</h2>
            
            <div class="payment-info">
                <div class="payment-step">
                    <div class="step-number">1</div>
                    <div>
                        <strong>Pay 1 USD for 1 month unlimited access</strong>
                        <p>Crypto Account: <strong>453535</strong></p>
                    </div>
                </div>
                
                <div class="payment-step">
                    <div class="step-number">2</div>
                    <div>
                        <strong>Enter Transaction ID</strong>
                        <input type="text" id="transaction-id" class="code-input" placeholder="Enter your transaction ID">
                        <button id="submit-transaction" class="btn submit-btn">Submit Transaction ID</button>
                    </div>
                </div>
                
                <div class="payment-step">
                    <div class="step-number">3</div>
                    <div>
                        <strong>Get Unlock Code</strong>
                        <input type="text" id="unlock-code-popup" class="code-input" placeholder="Enter unlock code">
                        <button id="unlock-btn-popup" class="btn btn-full" style="margin-top: 10px;">Unlock Premium</button>
                    </div>
                </div>
            </div>
            
            <a href="https://wa.me/1234567890?text=Hello%20Slipzy%20Admin,%20I%20have%20made%20the%20payment%20with%20Transaction%20ID:" id="whatsapp-link" class="btn whatsapp-btn hidden" target="_blank">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893-.001-3.189-1.262-6.187-3.55-8.418"/>
                </svg>
                Contact Admin on WhatsApp
            </a>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo">Slipzy <span class="security-badge">üîí Encrypted</span></div>
            <!-- Admin Panel link -->
            <a href="admin.html" class="admin-link" target="_blank">Admin Panel</a>
        </div>

        <!-- Main App -->
        <div id="main-app">
            <section class="hero">
                <div class="hero-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h6l-4 8 12-12h-6l4-8z"/>
                    </svg>
                    ULTRA SECURE PREMIUM PACKAGING SLIPS
                </div>
                <h1>Slipzy</h1>
                <p>Transform multiple orders into beautiful, printable packaging slips with bulk PNG output</p>
                
                <div class="grid">
                    <div class="card" style="animation: fadeInUp 0.6s var(--ease) 0.5s both">
                        <h2 class="card-title">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                            Customer Data Input
                        </h2>
                        
                        <div class="input-section">
                            <div class="tabs">
                                <div class="tab active" data-tab="upload">Upload Files</div>
                                <div class="tab" data-tab="paste">Paste Text</div>
                                <div class="tab" data-tab="bulk">Bulk Processing</div>
                            </div>
                            
                            <div class="tab-content active" id="upload-tab">
                                <div class="file-upload-area" id="file-upload-area">
                                    <i>üìÅ</i>
                                    <p><strong>Drag & drop files or click to browse</strong></p>
                                    <p style="color: var(--text-light); margin-top: 8px; font-size: 0.9rem;">Supports: TXT, CSV, XLSX, JSON</p>
                                    <div class="file-types">
                                        <span class="file-type-badge">.txt</span>
                                        <span class="file-type-badge">.csv</span>
                                        <span class="file-type-badge">.xlsx</span>
                                        <span class="file-type-badge">.json</span>
                                    </div>
                                    <input type="file" id="file-input" class="file-input" accept=".txt,.csv,.xlsx,.json" multiple>
                                </div>
                                <div id="file-preview" class="hidden"></div>
                                <div id="upload-status" class="hidden" style="margin-top: var(--spacing-sm); padding: var(--spacing-sm); background: rgba(52, 199, 89, 0.1); border-radius: var(--radius-sm); border: 1px solid rgba(52, 199, 89, 0.2);">
                                    <span class="success">‚úÖ File uploaded successfully!</span>
                                </div>
                            </div>
                            
                            <div class="tab-content" id="paste-tab">
                                <textarea id="text-input" placeholder="Paste customer data here. Each customer should be separated by a blank line.

Example:
John Doe ‚Ä¢ Apple Inc.
(555) 123-4567 ‚Ä¢ john@apple.com
123 Main Street, San Francisco, CA 94105
iPhone 15 Pro Max ‚Ä¢ Space Black
$1,199.00 ‚Ä¢ Priority Shipping
Signature required ‚Ä¢ Gift wrapping"></textarea>
                            </div>

                            <div class="tab-content" id="bulk-tab">
                                <div class="features-panel">
                                    <h3 style="margin-bottom: var(--spacing-sm); font-size: 1.1rem;">Advanced Bulk Processing</h3>
                                    <div class="features-grid">
                                        <div class="feature-item">
                                            <div class="feature-icon">üîÑ</div>
                                            <div>
                                                <strong>Auto Address Correction</strong>
                                                <div style="font-size: 0.75rem; color: var(--text-light);">Standardizes messy addresses</div>
                                            </div>
                                        </div>
                                        <div class="feature-item">
                                            <div class="feature-icon">üè¢</div>
                                            <div>
                                                <strong>Company Detection</strong>
                                                <div style="font-size: 0.75rem; color: var(--text-light);">Auto-extracts company names</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <textarea id="bulk-input" placeholder="Paste messy customer data here - we'll automatically clean and format it...

Example messy input:
john doe 123 main st sf ca 1234
555-123-4567
iphone 15 $1199
note: sig req"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="animation: fadeInUp 0.6s var(--ease) 0.6s both">
                        <h2 class="card-title">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/>
                                <line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                            Settings & Output
                        </h2>
                        
                        <div class="settings-grid">
                            <div class="setting-group">
                                <div class="setting-label">Output Format</div>
                                <div class="toggle-group">
                                    <div class="toggle-option active" data-format="png">PNG Images</div>
                                    <div class="toggle-option" data-format="pdf">PDF Document</div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <div class="setting-label">QR Code Link</div>
                                <div class="input-with-icon">
                                    <div class="input-icon">üîó</div>
                                    <input type="text" id="qr-link" placeholder="https://your-store.com/track/" value="https://your-store.com/track/">
                                </div>
                            </div>

                            <div class="setting-group">
                                <div class="setting-label">Default Company</div>
                                <div class="input-with-icon">
                                    <div class="input-icon">üè¢</div>
                                    <input type="text" id="default-company" placeholder="Your Company Name" value="Slipzy">
                                </div>
                            </div>
                        </div>

                        <div class="features-panel">
                            <h3 style="margin-bottom: var(--spacing-sm); font-size: 1.1rem;">Premium Features</h3>
                            <div class="features-grid">
                                <div class="feature-item">
                                    <div class="feature-icon">üì±</div>
                                    <div>
                                        <strong>QR Codes</strong>
                                        <div style="font-size: 0.75rem; color: var(--text-light);">Track orders easily</div>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">üè¢</div>
                                    <div>
                                        <strong>Company Branding</strong>
                                        <div style="font-size: 0.75rem; color: var(--text-light);">Add your logo & info</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button id="generate-btn" class="btn btn-large btn-full" style="margin-top: var(--spacing-md);">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                            Generate Premium Slips
                        </button>
                    </div>
                </div>
            </section>

            <!-- Preview Section -->
            <section id="preview-section" class="preview-section hidden" style="animation: fadeInUp 0.6s var(--ease) 0.7s both">
                <div class="card">
                    <h2 class="card-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21,15 16,10 5,21"/>
                        </svg>
                        Slip Preview
                    </h2>
                    
                    <div class="preview-container">
                        <div class="preview-header">
                            <h3>Packaging Slip Preview</h3>
                            <div class="preview-count">Slip <span id="current-slip">1</span> of <span id="total-slips">0</span></div>
                        </div>
                        <canvas id="slip-preview" class="slip-preview" width="1000" height="1400"></canvas>
                        
                        <div class="preview-controls">
                            <div class="preview-nav">
                                <button id="prev-slip" class="preview-btn" disabled>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="15,18 9,12 15,6"/>
                                    </svg>
                                    Previous
                                </button>
                                <button id="next-slip" class="preview-btn" disabled>
                                    Next
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="9,18 15,12 9,6"/>
                                    </svg>
                                </button>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <button id="print-btn" class="btn print-btn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6,9 6,2 18,2 18,9"/>
                                        <path d="M6,18H4a2,2,0,0,1-2-2V9a2,2,0,0,1,2-2H20a2,2,0,0,1,2,2v7a2,2,0,0,1-2,2H18"/>
                                        <rect x="6" y="14" width="12" height="8"/>
                                    </svg>
                                    Print
                                </button>
                                <button id="download-all" class="btn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21,15v4a2,2,0,0,1-2,2H5a2,2,0,0,1-2-2V15"/>
                                        <polyline points="7,10 12,15 17,10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Download All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card usage-section" style="animation: fadeInUp 0.6s var(--ease) 0.8s both">
                <h2 class="card-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    Usage & Licensing
                </h2>
                
                <div id="usage-info" class="usage-info">
                    <span class="success">‚ú® Premium: Unlimited Slips Available</span>
                </div>
                
                <div id="upgrade-panel" class="upgrade-panel hidden">
                    <h3>‚ú® Free Limit Reached</h3>
                    <p>You've reached the free usage limit. Upgrade to premium for unlimited access.</p>
                    <button id="upgrade-btn" class="btn">Upgrade to Premium</button>
                </div>
            </section>
        </div>

        <footer class="footer">
            <p>Slipzy ‚Ä¢ Ultra Secure Premium Packaging Slips ‚Ä¢ Encrypted Usage Tracking ‚Ä¢ ¬© 2024</p>
        </footer>
    </div>

    <script>
        // ============================================
        // ULTRA SECURE CODE PROTECTION SYSTEM
        // ============================================
        
        // Dynamically inject CSS to prevent inspection
        const protectedCSS = `
        /* CSS Variables */
        :root {
            --primary: #6C63FF;
            --primary-light: #8B85FF;
            --primary-dark: #554FD8;
            --primary-gradient: linear-gradient(135deg, #6C63FF 0%, #8B85FF 100%);
            --primary-gradient-hover: linear-gradient(135deg, #554FD8 0%, #6C63FF 100%);
            --text: #1D1D1F;
            --text-light: #86868B;
            --text-lighter: #AEAEB2;
            --bg: #FFFFFF;
            --card-bg: #FFFFFF;
            --card-bg-hover: #FBFBFD;
            --border: #F2F2F7;
            --border-hover: #E5E5EA;
            --radius: 20px;
            --radius-sm: 12px;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 16px 48px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 32px 96px rgba(0, 0, 0, 0.16);
            --spacing-xs: 0.75rem;
            --spacing-sm: 1.25rem;
            --spacing-md: 2rem;
            --spacing-lg: 3rem;
            --spacing-xl: 5rem;
            --ease: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
            width: 100%;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #F5F7FA 0%, #FBFBFD 100%);
            min-height: 100vh;
            overflow-x: hidden;
            font-synthesis: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-overflow-scrolling: touch;
            overflow-anchor: none;
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: var(--spacing-lg);
            position: relative;
            z-index: 100;
            background: linear-gradient(135deg, #F5F7FA 0%, #FBFBFD 100%);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: var(--spacing-lg) 0;
            position: relative;
            contain: layout style paint;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -200px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 1200px;
            height: 1200px;
            background: radial-gradient(circle, rgba(108, 99, 255, 0.04) 0%, rgba(108, 99, 255, 0) 70%);
            z-index: -1;
            animation: float 8s ease-in-out infinite;
            will-change: transform;
            transform: translateZ(0);
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: rgba(108, 99, 255, 0.08);
            color: var(--primary);
            padding: 10px 18px;
            border-radius: 100px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            animation: fadeInUp 0.6s var(--ease) 0.2s both;
            border: 1px solid rgba(108, 99, 255, 0.1);
            backdrop-filter: blur(20px);
            will-change: transform, opacity;
        }

        .hero h1 {
            font-size: clamp(2.25rem, 6vw, 4rem);
            font-weight: 900;
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, var(--text) 0%, var(--text-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 0.6s var(--ease) 0.3s both;
            line-height: 1.1;
            letter-spacing: -0.02em;
            padding: 0 var(--spacing-sm);
            will-change: transform, opacity;
        }

        .hero p {
            font-size: clamp(1rem, 3vw, 1.25rem);
            color: var(--text-light);
            max-width: 600px;
            margin: 0 auto var(--spacing-lg);
            animation: fadeInUp 0.6s var(--ease) 0.4s both;
            font-weight: 400;
            line-height: 1.5;
            padding: 0 var(--spacing-sm);
            will-change: transform, opacity;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: var(--spacing-md);
            transition: all 0.5s var(--ease);
            border: 1px solid var(--border);
            backdrop-filter: blur(40px);
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
            will-change: transform;
            contain: layout style paint;
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            border-color: var(--border-hover);
            background: var(--card-bg-hover);
            transform: translateY(-8px);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            letter-spacing: -0.01em;
        }

        /* Input Section */
        .input-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .tabs {
            display: flex;
            background: var(--border);
            border-radius: var(--radius-sm);
            padding: 4px;
            margin-bottom: var(--spacing-md);
            gap: 4px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 700;
            border-radius: var(--radius-sm);
            transition: all 0.4s var(--ease);
            text-align: center;
            color: var(--text-light);
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
            will-change: transform;
            transform: translateZ(0);
        }

        .tab.active {
            background: var(--bg);
            color: var(--text);
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s var(--ease);
        }

        .tab-content.active {
            display: block;
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            text-align: center;
            cursor: pointer;
            transition: all 0.4s var(--ease);
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.5);
            will-change: transform;
            transform: translateZ(0);
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.02);
            transform: translateY(-2px);
        }

        .file-upload-area i {
            font-size: 2.5rem;
            color: var(--text-lighter);
            margin-bottom: var(--spacing-sm);
            transition: all 0.4s var(--ease);
            display: block;
        }

        .file-input {
            display: none;
        }

        .file-types {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            margin-top: var(--spacing-sm);
        }

        .file-type-badge {
            background: rgba(108, 99, 255, 0.08);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            border: 1px solid rgba(108, 99, 255, 0.1);
        }

        /* Text Areas */
        textarea {
            width: 100%;
            min-height: 180px;
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            resize: vertical;
            transition: all 0.4s var(--ease);
            background: var(--bg);
            line-height: 1.6;
            color: var(--text);
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1);
        }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .setting-label {
            font-weight: 700;
            color: var(--text);
            font-size: 0.95rem;
        }

        .toggle-group {
            display: flex;
            background: var(--border);
            padding: 4px;
            border-radius: var(--radius-sm);
            gap: 4px;
        }

        .toggle-option {
            flex: 1;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s var(--ease);
            font-weight: 600;
            color: var(--text-light);
            text-align: center;
            font-size: 0.85rem;
            will-change: transform;
            transform: translateZ(0);
        }

        .toggle-option.active {
            background: var(--bg);
            color: var(--text);
            box-shadow: var(--shadow);
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon input {
            width: 100%;
            padding: 12px 12px 12px 44px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s var(--ease);
            background: var(--bg);
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .input-with-icon input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1);
        }

        .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        /* Buttons */
        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 14px 24px;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s var(--ease);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            position: relative;
            overflow: hidden;
            letter-spacing: -0.01em;
            width: 100%;
            will-change: transform;
            transform: translateZ(0);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            background: var(--primary-gradient-hover);
        }

        .btn-large {
            padding: 16px 24px;
            font-size: 1.25rem;
            border-radius: var(--radius);
        }

        .btn-full {
            width: 100%;
        }

        /* Features Panel */
        .features-panel {
            background: linear-gradient(135deg, #F8FAFF 0%, #F0F4FF 100%);
            border: 1px solid rgba(108, 99, 255, 0.1);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .features-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-sm);
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: rgba(255, 255, 255, 0.7);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(108, 99, 255, 0.1);
        }

        .feature-icon {
            width: 28px;
            height: 28px;
            background: var(--primary-gradient);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        /* Preview Section */
        .preview-section {
            margin-top: var(--spacing-lg);
        }

        .preview-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            background: white;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--primary-gradient);
            color: white;
        }

        .preview-header h3 {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .preview-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .slip-preview {
            width: 100%;
            height: auto;
            display: block;
        }

        .preview-controls {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-sm);
            gap: var(--spacing-sm);
        }

        .preview-nav {
            display: flex;
            gap: var(--spacing-xs);
        }

        .preview-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s var(--ease);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .preview-btn:hover {
            background: var(--card-bg-hover);
            border-color: var(--border-hover);
        }

        .preview-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Usage Section */
        .usage-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .usage-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            background: rgba(108, 99, 255, 0.04);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            transition: all 0.4s var(--ease);
            border: 1px solid rgba(108, 99, 255, 0.1);
        }

        .upgrade-panel {
            padding: var(--spacing-md);
            background: linear-gradient(135deg, #FFF3E0 0%, #FFECB3 100%);
            border-radius: var(--radius);
            border: 1px solid #FFD54F;
            animation: pulse 2s infinite;
            position: relative;
            overflow: hidden;
        }

        .code-input {
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            width: 100%;
            margin-bottom: var(--spacing-sm);
            transition: all 0.3s var(--ease);
            background: var(--bg);
            position: relative;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .code-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: var(--spacing-lg) 0;
            color: var(--text-light);
            font-size: 0.875rem;
            border-top: 1px solid var(--border);
            margin-top: var(--spacing-lg);
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(20px);
        }

        /* Popup Overlay */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: var(--spacing-md);
            animation: fadeIn 0.3s ease-out;
        }

        .popup-content {
            background: white;
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            position: relative;
            animation: scaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateZ(0);
        }

        .popup-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.3s var(--ease);
        }

        .popup-close:hover {
            color: var(--text);
            transform: scale(1.1);
        }

        .popup-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            color: var(--text);
        }

        .payment-info {
            background: rgba(108, 99, 255, 0.05);
            padding: var(--spacing-md);
            border-radius: var(--radius);
            margin-bottom: var(--spacing-md);
            border: 1px solid rgba(108, 99, 255, 0.1);
        }

        .payment-step {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .step-number {
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .whatsapp-btn {
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }

        .whatsapp-btn:hover {
            background: #128C7E;
        }

        .submit-btn {
            background: #007AFF;
            color: white;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: #0056CC;
        }

        /* Print Button */
        .print-btn {
            background: #34C759;
            color: white;
        }

        .print-btn:hover {
            background: #2CA24D;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translate3d(0, 30px, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.01);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translate3d(-50%, 0, 0);
            }
            50% {
                transform: translate3d(-50%, -10px, 0);
            }
        }

        /* Hidden class */
        .hidden {
            display: none;
        }

        /* Success, Warning, Error states */
        .success {
            color: #34C759;
        }

        .warning {
            color: #FF9500;
        }

        .error {
            color: #FF3B30;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .btn {
                width: auto;
            }
            
            .features-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: var(--spacing-md);
            }
            
            .settings-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 767px) {
            .container {
                padding: 0 var(--spacing-sm);
            }
            
            .hero {
                padding: var(--spacing-md) 0;
            }
            
            .card {
                padding: var(--spacing-sm);
            }
            
            .preview-container {
                max-width: 100%;
            }
            
            .preview-controls {
                flex-direction: column;
            }
            
            .preview-nav {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .tab {
                min-width: 100px;
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            
            .file-upload-area {
                padding: var(--spacing-md);
            }
            
            .file-upload-area i {
                font-size: 2rem;
            }
            
            textarea {
                min-height: 150px;
                padding: var(--spacing-sm);
            }
        }

        /* Print-specific styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .preview-container, .preview-container * {
                visibility: visible;
            }
            .preview-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
            .preview-header, .preview-controls {
                display: none !important;
            }
        }

        /* Performance optimizations */
        .card, .btn, .tab, .toggle-option, .file-upload-area {
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* Admin link */
        .admin-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            transition: all 0.3s var(--ease);
        }

        .admin-link:hover {
            background: rgba(108, 99, 255, 0.1);
        }
        
        /* Disabled state */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn:disabled:hover {
            transform: none !important;
            box-shadow: var(--shadow) !important;
        }
        
        /* Security badge */
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(52, 199, 89, 0.1);
            color: #34C759;
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(52, 199, 89, 0.2);
        }
        `;
        
        // Inject CSS
        const style = document.createElement('style');
        style.textContent = protectedCSS;
        document.head.appendChild(style);

        // ============================================
        // ULTRA PREMIUM SLIP DESIGN
        // ============================================
        
        // Global variables
        let userFingerprint = '';
        let usageCount = 0;
        const MAX_FREE_SLIPS = 10;
        let uploadedFiles = [];
        let generatedSlips = [];
        let currentSlipIndex = 0;
        
        // DOM elements
        const fileUploadArea = document.getElementById('file-upload-area');
        const fileInput = document.getElementById('file-input');
        const textInput = document.getElementById('text-input');
        const bulkInput = document.getElementById('bulk-input');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const toggleOptions = document.querySelectorAll('.toggle-option');
        const generateBtn = document.getElementById('generate-btn');
        const usageInfo = document.getElementById('usage-info');
        const upgradePanel = document.getElementById('upgrade-panel');
        const upgradeBtn = document.getElementById('upgrade-btn');
        const qrLinkInput = document.getElementById('qr-link');
        const defaultCompanyInput = document.getElementById('default-company');
        const previewSection = document.getElementById('preview-section');
        const slipPreview = document.getElementById('slip-preview');
        const currentSlipDisplay = document.getElementById('current-slip');
        const totalSlipsDisplay = document.getElementById('total-slips');
        const prevSlipBtn = document.getElementById('prev-slip');
        const nextSlipBtn = document.getElementById('next-slip');
        const downloadAllBtn = document.getElementById('download-all');
        const printBtn = document.getElementById('print-btn');
        const uploadStatus = document.getElementById('upload-status');
        const paymentPopup = document.getElementById('payment-popup');
        const closePopup = document.getElementById('close-popup');
        const unlockBtnPopup = document.getElementById('unlock-btn-popup');
        const unlockCodePopup = document.getElementById('unlock-code-popup');
        const transactionIdInput = document.getElementById('transaction-id');
        const submitTransactionBtn = document.getElementById('submit-transaction');
        const whatsappLink = document.getElementById('whatsapp-link');
        
        // Canvas context
        const ctx = slipPreview.getContext('2d');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            setupEventListeners();
            
            // Initialize code protection
            initializeCodeProtection();
            
            // Initialize usage tracking
            initializeUsageTracking();
            
            // Initialize smooth scrolling
            initializeSmoothScrolling();
        });
        
        function setupEventListeners() {
            // File upload
            fileUploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // Enhanced drag and drop for file upload
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('drag-over');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('drag-over');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect();
                }
            });
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update tab contents
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Toggle options
            toggleOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const group = option.parentElement;
                    group.querySelectorAll('.toggle-option').forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                });
            });
            
            // Generate button
            generateBtn.addEventListener('click', generateSlips);
            
            // Upgrade button
            upgradeBtn.addEventListener('click', () => {
                paymentPopup.style.display = 'flex';
            });
            
            // Close popup
            closePopup.addEventListener('click', () => {
                paymentPopup.style.display = 'none';
            });
            
            // Submit transaction ID button
            submitTransactionBtn.addEventListener('click', submitTransactionId);
            
            // Unlock button in popup
            unlockBtnPopup.addEventListener('click', verifyUnlockCode);
            
            // Preview navigation
            prevSlipBtn.addEventListener('click', showPreviousSlip);
            nextSlipBtn.addEventListener('click', showNextSlip);
            
            // Download all button
            downloadAllBtn.addEventListener('click', downloadAllSlips);
            
            // Print button
            printBtn.addEventListener('click', printSlips);
        }
        
        // ============================================
        // CODE PROTECTION SYSTEM
        // ============================================
        
        function initializeCodeProtection() {
            // Prevent right-click context menu
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Prevent F12 key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                    (e.ctrlKey && e.shiftKey && e.key === 'C') || (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Prevent text selection
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Prevent drag and drop
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Detect and block DevTools
            setInterval(function() {
                const start = Date.now();
                debugger;
                if (Date.now() - start > 100) {
                    window.location.reload();
                }
            }, 1000);
            
            // Obfuscate function names and variables
            obfuscateCode();
        }
        
        function obfuscateCode() {
            // This is a simple obfuscation - in production use proper obfuscation tools
            const originalFunctions = {
                'setupEventListeners': 'a1',
                'handleFileSelect': 'a2',
                'initializeUsageTracking': 'a3',
                'generateSlips': 'a4',
                'parseCustomerData': 'a5',
                'drawSlipDesign': 'a6',
                'updatePreviewDisplay': 'a7',
                'downloadAllSlips': 'a8',
                'printSlips': 'a9',
                'submitTransactionId': 'a10',
                'verifyUnlockCode': 'a11'
            };
            
            // Rename functions to make code harder to read
            // In a real implementation, this would be done by a build process
        }
        
        // Initialize smooth scrolling
        function initializeSmoothScrolling() {
            if ('scrollBehavior' in document.documentElement.style) {
                return;
            }
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }
        
        function handleFileSelect() {
            if (fileInput.files.length === 0) return;
            
            uploadedFiles = Array.from(fileInput.files);
            
            // Show upload status
            uploadStatus.classList.remove('hidden');
            
            // Process all files
            let allContent = '';
            let processedFiles = 0;
            
            uploadedFiles.forEach((file, index) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    allContent += e.target.result + '\n\n';
                    processedFiles++;
                    
                    if (processedFiles === uploadedFiles.length) {
                        // All files processed
                        if (textInput) {
                            textInput.value = allContent.trim();
                        }
                    }
                };
                
                reader.readAsText(file);
            });
        }
        
        function initializeUsageTracking() {
            // For demo purposes, show premium status
            updateUsageDisplay(true);
        }
        
        function updateUsageDisplay(isUnlocked) {
            if (isUnlocked) {
                usageInfo.innerHTML = '<span class="success">‚ú® Premium: Unlimited Slips Available</span>';
                upgradePanel.classList.add('hidden');
                generateBtn.disabled = false;
            } else {
                const remaining = MAX_FREE_SLIPS - usageCount;
                if (remaining > 0) {
                    usageInfo.innerHTML = `<span>Free slips remaining: <strong>${remaining}/${MAX_FREE_SLIPS}</strong></span>`;
                    upgradePanel.classList.add('hidden');
                    generateBtn.disabled = false;
                } else {
                    usageInfo.innerHTML = '<span class="warning">Free limit reached. Upgrade required.</span>';
                    upgradePanel.classList.remove('hidden');
                    generateBtn.disabled = true;
                }
            }
        }
        
        function submitTransactionId() {
            const transactionId = transactionIdInput.value.trim();
            
            if (!transactionId) {
                alert('Please enter a transaction ID.');
                return;
            }
            
            // Update WhatsApp link with transaction ID
            whatsappLink.href = `https://wa.me/1234567890?text=Hello%20Slipzy%20Admin,%20I%20have%20made%20the%20payment%20with%20Transaction%20ID:%20${encodeURIComponent(transactionId)}`;
            
            // Show WhatsApp button
            whatsappLink.classList.remove('hidden');
            
            // Show success message
            alert('Transaction ID submitted! Please contact admin on WhatsApp to get your unlock code.');
        }
        
        function verifyUnlockCode() {
            const code = unlockCodePopup.value.trim();
            
            if (!code) {
                alert('Please enter an unlock code.');
                return;
            }
            
            // For demo, accept any code
            updateUsageDisplay(true);
            paymentPopup.style.display = 'none';
            
            // Show success animation
            usageInfo.innerHTML = '<span class="success">üéâ Successfully Unlocked! Enjoy unlimited premium features.</span>';
            setTimeout(() => {
                updateUsageDisplay(true);
            }, 3000);
        }
        
        function parseCustomerData(text) {
            // Split by blank lines (multiple newlines)
            const entries = text.split(/\n\s*\n/);
            const customers = [];
            
            entries.forEach(entry => {
                if (entry.trim() === '') return;
                
                const lines = entry.split('\n').filter(line => line.trim() !== '');
                const customer = {
                    name: '',
                    company: defaultCompanyInput.value || '',
                    phone: '',
                    email: '',
                    address: '',
                    product: '',
                    price: '',
                    note: '',
                    orderId: generateOrderId()
                };
                
                // Enhanced parsing with AI-like pattern detection
                lines.forEach(line => {
                    const cleanLine = line.trim();
                    if (!cleanLine) return;
                    
                    // Email detection
                    const emailMatch = cleanLine.match(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/);
                    if (emailMatch && !customer.email) {
                        customer.email = emailMatch[0];
                    }
                    
                    // Company detection (look for Inc, LLC, Corp, etc.)
                    const companyMatch = cleanLine.match(/(.+)\s+(Inc|LLC|Corp|Corporation|Ltd|Company|Co\.)/i);
                    if (companyMatch && !customer.company) {
                        customer.company = companyMatch[0];
                    }
                    
                    // Phone detection
                    const phoneMatch = cleanLine.match(/(\+\d{1,3}[-.]?)?\(?(\d{3})\)?[-.]?(\d{3})[-.]?(\d{4})/);
                    if (phoneMatch && !customer.phone) {
                        customer.phone = phoneMatch[0];
                    }
                    
                    // Price detection
                    const priceMatch = cleanLine.match(/\$?(\d{1,3}(,\d{3})*|\d+)(\.\d{2})?/);
                    if (priceMatch && cleanLine.toLowerCase().includes('$') && !customer.price) {
                        customer.price = priceMatch[0];
                    }
                    
                    // Address-like patterns
                    if ((cleanLine.includes('street') || cleanLine.includes('st') || cleanLine.includes('ave') || 
                         cleanLine.includes('avenue') || cleanLine.includes('road') || cleanLine.includes('rd') ||
                         cleanLine.includes('lane') || cleanLine.includes('ln') || cleanLine.includes('drive') || 
                         cleanLine.includes('dr') || /\d{5}/.test(cleanLine)) && !customer.address) {
                        customer.address = formatAddress(cleanLine);
                    }
                    
                    // Product detection (if not price, email, phone, etc.)
                    if (!customer.product && !emailMatch && !phoneMatch && !priceMatch && 
                        !cleanLine.includes('@') && cleanLine.length > 3) {
                        customer.product = cleanLine;
                    }
                    
                    // Note detection (short lines, specific keywords)
                    if ((cleanLine.toLowerCase().includes('note:') || 
                         cleanLine.toLowerCase().includes('signature') ||
                         cleanLine.toLowerCase().includes('gift') ||
                         cleanLine.length < 30) && !customer.note) {
                        customer.note = cleanLine;
                    }
                });
                
                // Fallback assignments
                if (!customer.name && lines[0]) {
                    customer.name = lines[0].split('‚Ä¢')[0].trim();
                }
                
                if (!customer.product && lines.find(line => line.includes('$'))) {
                    const priceLine = lines.find(line => line.includes('$'));
                    customer.product = priceLine.split('$')[0].trim();
                }
                
                // Validate that we have at least some customer data
                if (customer.name || customer.address || customer.product) {
                    customers.push(customer);
                }
            });
            
            return customers;
        }
        
        function formatAddress(rawAddress) {
            // Simple address formatting
            let address = rawAddress
                .replace(/\s+/g, ' ')
                .replace(/(\d+)([A-Za-z])/g, '$1 $2')
                .replace(/([A-Za-z])(\d+)/g, '$1 $2')
                .replace(/\bSt\b/gi, 'Street')
                .replace(/\bAve\b/gi, 'Avenue')
                .replace(/\bRd\b/gi, 'Road')
                .replace(/\bDr\b/gi, 'Drive')
                .replace(/\bLn\b/gi, 'Lane')
                .replace(/\bBlvd\b/gi, 'Boulevard');
            
            return address;
        }
        
        function generateOrderId() {
            return 'ORD' + Date.now().toString().slice(-8) + Math.random().toString(36).substr(2, 5).toUpperCase();
        }
        
        function generateSlips() {
            let inputText = '';
            const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
            
            if (activeTab === 'upload' && uploadedFiles.length > 0) {
                inputText = textInput.value;
            } else if (activeTab === 'paste') {
                inputText = textInput.value;
            } else if (activeTab === 'bulk') {
                inputText = bulkInput.value;
            }
            
            if (!inputText.trim()) {
                alert('Please enter customer data or upload files.');
                return;
            }
            
            const customers = parseCustomerData(inputText);
            if (customers.length === 0) {
                alert('No valid customer data found. Please check your input format.');
                return;
            }
            
            // Show loading state
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<div class="loading"></div> Generating...';
            generateBtn.disabled = true;
            
            // Generate slips after a short delay to show loading state
            setTimeout(() => {
                try {
                    // Generate slip images
                    generatedSlips = generateSlipImages(customers);
                    
                    // Show preview section
                    previewSection.classList.remove('hidden');
                    
                    // Update preview display
                    currentSlipIndex = 0;
                    updatePreviewDisplay();
                    
                    // Reset button state
                    generateBtn.innerHTML = originalText;
                    generateBtn.disabled = false;
                    
                    // Show success message
                    usageInfo.innerHTML = `<span class="success">‚úÖ Generated ${customers.length} premium packaging slip(s)!</span>`;
                    setTimeout(() => {
                        updateUsageDisplay(true);
                    }, 3000);
                    
                } catch (error) {
                    console.error('Slip Generation Error:', error);
                    // Reset button state and show error
                    generateBtn.innerHTML = originalText;
                    generateBtn.disabled = false;
                    usageInfo.innerHTML = `<span class="error">Error generating slips: ${error.message}</span>`;
                    setTimeout(() => {
                        updateUsageDisplay(true);
                    }, 3000);
                }
            }, 100);
        }
        
        function generateSlipImages(customers) {
            const slips = [];
            
            customers.forEach(customer => {
                // Create a temporary canvas for each slip with high resolution
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = 1000; // High resolution for printing
                tempCanvas.height = 1400;
                const tempCtx = tempCanvas.getContext('2d');
                
                // Draw the slip design
                drawSlipDesign(tempCtx, customer, 1000, 1400);
                
                // Store the canvas data
                slips.push({
                    canvas: tempCanvas,
                    customer: customer
                });
            });
            
            return slips;
        }
        
        // ============================================
        // ULTRA PREMIUM SLIP DESIGN - APPLE LEVEL DESIGN
        // ============================================
        
        function drawSlipDesign(ctx, customer, width, height) {
            // Clear canvas with premium white
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, width, height);
            
            // Premium subtle background pattern
            drawPremiumBackground(ctx, width, height);
            
            // Ultra premium header with gradient and subtle shadow
            const headerHeight = 180;
            const headerGradient = ctx.createLinearGradient(0, 0, width, 0);
            headerGradient.addColorStop(0, '#1a1a2e');
            headerGradient.addColorStop(0.5, '#16213e');
            headerGradient.addColorStop(1, '#0f3460');
            
            ctx.fillStyle = headerGradient;
            ctx.fillRect(0, 0, width, headerHeight);
            
            // Add subtle header pattern
            ctx.fillStyle = 'rgba(255, 255, 255, 0.03)';
            for (let i = 0; i < width; i += 25) {
                ctx.fillRect(i, 0, 1, headerHeight);
            }
            
            // Premium typography for header
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 52px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('SLIP', width / 2, 70);
            
            ctx.font = '300 28px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.fillText('Packaging Document', width / 2, 110);
            
            // Company name in elegant typography
            ctx.font = '500 24px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.fillText(customer.company || 'SLIPZY PREMIUM', width / 2, 140);
            
            // Content area with perfect alignment
            let yPos = headerHeight + 60;
            
            // Client Information Section
            drawSectionHeader(ctx, 'CLIENT INFORMATION', 80, yPos, width - 160);
            yPos += 50;
            
            // Name with elegant styling
            if (customer.name) {
                drawInfoRow(ctx, 'Name:', customer.name, 80, yPos, width - 160);
                yPos += 45;
            }
            
            // Company
            if (customer.company && customer.company !== defaultCompanyInput.value) {
                drawInfoRow(ctx, 'Company:', customer.company, 80, yPos, width - 160);
                yPos += 45;
            }
            
            // Phone (FIXED: Only show once)
            if (customer.phone) {
                drawInfoRow(ctx, 'Phone:', customer.phone, 80, yPos, width - 160);
                yPos += 45;
            }
            
            // Email
            if (customer.email) {
                drawInfoRow(ctx, 'Email:', customer.email, 80, yPos, width - 160);
                yPos += 45;
            }
            
            // Address with perfect formatting
            if (customer.address) {
                drawInfoRow(ctx, 'Address:', customer.address, 80, yPos, width - 160);
                yPos += 60; // Extra space for address
            }
            
            // Elegant divider
            yPos += 30;
            drawElegantDivider(ctx, 80, yPos, width - 160);
            yPos += 50;
            
            // Order Details Section
            drawSectionHeader(ctx, 'ORDER DETAILS', 80, yPos, width - 160);
            yPos += 50;
            
            // Product
            if (customer.product) {
                drawInfoRow(ctx, 'Product:', customer.product, 80, yPos, width - 160);
                yPos += 45;
            }
            
            // Price with premium styling
            if (customer.price) {
                drawInfoRow(ctx, 'Amount:', customer.price, 80, yPos, width - 160);
                yPos += 45;
            }
            
            // Order ID with subtle styling
            drawInfoRow(ctx, 'Order ID:', customer.orderId, 80, yPos, width - 160);
            yPos += 60;
            
            // QR Code Section with premium styling
            const qrSize = 200;
            const qrX = width - qrSize - 80;
            const qrY = yPos;
            
            // QR Code background with subtle shadow
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(qrX - 10, qrY - 10, qrSize + 20, qrSize + 20);
            
            // Generate and draw QR code
            const qrLink = qrLinkInput.value;
            const qrCode = generateQRCode(qrLink);
            if (qrCode) {
                ctx.drawImage(qrCode, qrX, qrY, qrSize, qrSize);
            }
            
            // QR Code label with premium typography
            ctx.fillStyle = '#6c757d';
            ctx.font = '500 18px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('SCAN TO TRACK', qrX + qrSize/2, qrY + qrSize + 30);
            
            // Notes section if available
            if (customer.note) {
                yPos = Math.max(yPos, qrY + qrSize + 60);
                drawSectionHeader(ctx, 'SPECIAL INSTRUCTIONS', 80, yPos, width - 160);
                yPos += 50;
                
                ctx.fillStyle = '#e74c3c';
                ctx.font = '500 20px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText(customer.note, 80, yPos);
            }
            
            // Premium footer
            const footerY = height - 60;
            drawElegantDivider(ctx, 80, footerY - 40, width - 160);
            
            ctx.fillStyle = '#6c757d';
            ctx.font = '400 16px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Thank you for your business ‚Ä¢ Slipzy Premium Packaging', width / 2, footerY);
        }
        
        function drawPremiumBackground(ctx, width, height) {
            // Very subtle background pattern
            ctx.fillStyle = 'rgba(248, 249, 250, 0.3)';
            for (let i = 0; i < width; i += 120) {
                for (let j = 0; j < height; j += 120) {
                    if ((i + j) % 240 === 0) {
                        ctx.fillRect(i, j, 2, 2);
                    }
                }
            }
        }
        
        function drawSectionHeader(ctx, text, x, y, maxWidth) {
            ctx.fillStyle = '#2c3e50';
            ctx.font = '600 22px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(text, x, y);
            
            // Underline
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y + 5);
            const textWidth = ctx.measureText(text).width;
            ctx.lineTo(x + textWidth, y + 5);
            ctx.stroke();
        }
        
        function drawInfoRow(ctx, label, value, x, y, maxWidth) {
            // Label with premium styling
            ctx.fillStyle = '#495057';
            ctx.font = '500 18px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(label, x, y);
            
            // Value with elegant styling
            ctx.fillStyle = '#2c3e50';
            ctx.font = '400 18px "Inter", -apple-system, BlinkMacSystemFont, sans-serif';
            
            // Handle long values by wrapping text
            const labelWidth = ctx.measureText(label).width;
            const valueX = x + labelWidth + 20;
            const availableWidth = maxWidth - (valueX - x);
            
            const words = value.split(' ');
            let line = '';
            let lineY = y;
            
            for (let i = 0; i < words.length; i++) {
                const testLine = line + words[i] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > availableWidth && i > 0) {
                    ctx.fillText(line, valueX, lineY);
                    line = words[i] + ' ';
                    lineY += 25;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, valueX, lineY);
            
            return lineY - y + 25;
        }
        
        function drawElegantDivider(ctx, x, y, width) {
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + width, y);
            ctx.stroke();
            
            // Add subtle dots at ends
            ctx.fillStyle = '#dee2e6';
            ctx.beginPath();
            ctx.arc(x, y, 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + width, y, 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function generateQRCode(text) {
            try {
                const typeNumber = 4;
                const errorCorrectionLevel = 'L';
                const qr = qrcode(typeNumber, errorCorrectionLevel);
                qr.addData(text);
                qr.make();
                
                const cellSize = 6;
                const margin = 4;
                const size = qr.getModuleCount() * cellSize + margin * 2;
                
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                // Fill background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, size, size);
                
                // Draw QR code
                ctx.fillStyle = '#000000';
                for (let row = 0; row < qr.getModuleCount(); row++) {
                    for (let col = 0; col < qr.getModuleCount(); col++) {
                        if (qr.isDark(row, col)) {
                            ctx.fillRect(
                                col * cellSize + margin,
                                row * cellSize + margin,
                                cellSize,
                                cellSize
                            );
                        }
                    }
                }
                
                return canvas;
            } catch (e) {
                console.error('QR Code generation failed:', e);
                return null;
            }
        }
        
        function updatePreviewDisplay() {
            if (generatedSlips.length === 0) return;
            
            // Update slip count display
            currentSlipDisplay.textContent = currentSlipIndex + 1;
            totalSlipsDisplay.textContent = generatedSlips.length;
            
            // Update navigation buttons
            prevSlipBtn.disabled = currentSlipIndex === 0;
            nextSlipBtn.disabled = currentSlipIndex === generatedSlips.length - 1;
            
            // Draw the current slip on the preview canvas
            const currentSlip = generatedSlips[currentSlipIndex];
            ctx.clearRect(0, 0, slipPreview.width, slipPreview.height);
            ctx.drawImage(currentSlip.canvas, 0, 0, slipPreview.width, slipPreview.height);
        }
        
        function showPreviousSlip() {
            if (currentSlipIndex > 0) {
                currentSlipIndex--;
                updatePreviewDisplay();
            }
        }
        
        function showNextSlip() {
            if (currentSlipIndex < generatedSlips.length - 1) {
                currentSlipIndex++;
                updatePreviewDisplay();
            }
        }
        
        function downloadAllSlips() {
            if (generatedSlips.length === 0) return;
            
            // Show loading state on download button
            const originalText = downloadAllBtn.innerHTML;
            downloadAllBtn.innerHTML = '<div class="loading"></div> Preparing...';
            downloadAllBtn.disabled = true;
            
            // Check output format
            const isPDF = document.querySelector('[data-format="pdf"]').classList.contains('active');
            
            if (isPDF) {
                generatePDF();
            } else {
                // Download all PNGs
                setTimeout(() => {
                    let downloaded = 0;
                    
                    // Download each slip
                    generatedSlips.forEach((slip, index) => {
                        setTimeout(() => {
                            const link = document.createElement('a');
                            link.download = `premium-slip-${index + 1}.png`;
                            link.href = slip.canvas.toDataURL('image/png', 1.0);
                            link.click();
                            downloaded++;
                            
                            // If all downloaded, show success message
                            if (downloaded === generatedSlips.length) {
                                downloadAllBtn.innerHTML = originalText;
                                downloadAllBtn.disabled = false;
                                
                                // Show success message
                                usageInfo.innerHTML = `<span class="success">‚úÖ Downloaded ${downloaded} premium slip(s)!</span>`;
                                setTimeout(() => {
                                    updateUsageDisplay(true);
                                }, 3000);
                            }
                        }, index * 100);
                    });
                }, 500);
            }
        }
        
        function generatePDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Generate PDF for each customer
                generatedSlips.forEach((slip, index) => {
                    if (index > 0) {
                        doc.addPage();
                    }
                    
                    // Add the slip image to PDF
                    const imgData = slip.canvas.toDataURL('image/jpeg', 1.0);
                    doc.addImage(imgData, 'JPEG', 10, 10, 190, 0);
                });
                
                // Save the PDF
                doc.save(`premium-packaging-slips-${new Date().toISOString().slice(0, 10)}.pdf`);
                
                // Reset button state
                downloadAllBtn.innerHTML = originalText;
                downloadAllBtn.disabled = false;
                
                // Show success message
                usageInfo.innerHTML = `<span class="success">‚úÖ Downloaded PDF with ${generatedSlips.length} premium slip(s)!</span>`;
                setTimeout(() => {
                    updateUsageDisplay(true);
                }, 3000);
                
            } catch (error) {
                console.error('PDF Generation Error:', error);
                // Reset button state and show error
                downloadAllBtn.innerHTML = originalText;
                downloadAllBtn.disabled = false;
                usageInfo.innerHTML = `<span class="error">Error generating PDF: ${error.message}</span>`;
            }
        }
        
        function printSlips() {
            if (generatedSlips.length === 0) return;
            
            // Create a print-friendly HTML page
            const printWindow = window.open('', '_blank');
            
            // Create a clean print layout with only the slips
            let printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Print Slipzy Premium Packaging Slips</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 0; 
                            padding: 0;
                        }
                        .slip-container {
                            page-break-after: always;
                            margin: 0;
                            padding: 0;
                            width: 100%;
                        }
                        .slip-container:last-child {
                            page-break-after: avoid;
                        }
                        .slip-image {
                            width: 100%;
                            height: auto;
                        }
                        @media print {
                            body { margin: 0; padding: 0; }
                            .slip-container { margin: 0; padding: 0; }
                        }
                    </style>
                </head>
                <body>
            `;
            
            // Add each slip to the print page
            generatedSlips.forEach((slip, index) => {
                printContent += `
                    <div class="slip-container">
                        <img class="slip-image" src="${slip.canvas.toDataURL('image/png', 1.0)}" alt="Premium Packaging Slip ${index + 1}">
                    </div>
                `;
            });
            
            printContent += '</body></html>';
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Wait for images to load then print
            printWindow.onload = function() {
                setTimeout(() => {
                    printWindow.print();
                    // Close the print window after printing
                    setTimeout(() => {
                        printWindow.close();
                    }, 500);
                }, 500);
            };
        }
    </script>
</body>
</html>
